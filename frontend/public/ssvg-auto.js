!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SSVG=e():t.SSVG=e()}(window,function(){return function(t){var e={};function s(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(r,o,function(e){return t[e]}.bind(null,o));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{static parseTransform(t){const e={translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0,translateBeforeScale:!1};if(t){if("string"!=typeof t)return e.scaleX=t.k,e.scaleY=t.k,e.translateX=t.x,e.translateY=t.y,e;let s=t;s=s.replace(/ /g,"");const r=/\s*translate\(([-0-9.]+),([-0-9.]+)\)/.exec(s);r&&(e.translateX=parseFloat(r[1]),e.translateY=parseFloat(r[2]));const o=/\s*scale\(([-0-9.]+)\)/.exec(s);o&&(e.scaleX=parseFloat(o[1]),e.scaleY=parseFloat(o[1]));const i=/\s*rotate\(([-0-9.]+)\)/.exec(s);i&&(e.rotate=parseFloat(i[1])),/\s*translate\(([-0-9.]+),([-0-9.]+)\)scale\(([-0-9.]+)\)/.exec(s)&&(e.translateBeforeScale=!0);const l=/\s*matrix\(([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+)\)/.exec(s);l&&(e.scaleX=parseFloat(l[1]),e.scaleY=parseFloat(l[4]),e.translateX=parseFloat(l[5]),e.translateY=parseFloat(l[6]))}return e}static addTransforms(t,e){return{translateX:t.translateX+e.translateX,translateY:t.translateY+e.translateY,scaleX:t.scaleX*e.scaleX,scaleY:t.scaleY*e.scaleY,rotate:t.rotate+e.rotate}}static convertSizeToPx(t,e=!0){const s=e?14:void 0;return void 0===t?s:"number"==typeof t?t:"em"===t.substr(-2)?Math.round(12*parseFloat(t)):"px"===t.substr(-2)?parseInt(t):t.match(/^[0-9]+$/)?parseInt(t):(console.warn("size in unsupported format: ",t),s)}static colorToRgba(t,e=1){if(!t||"none"===t)return"none";if(t=r.CssNamedColorToHex(t),1===e&&"string"==typeof t)return t;if("string"==typeof t&&"#"===t[0]){let s;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return 3==(s=t.substring(1)).length&&(s=s[0]+s[0]+s[1]+s[1]+s[2]+s[2]),"rgba("+[(s="0x"+s)>>16&255,s>>8&255,255&s].join(",")+","+e+")";throw new Error("Bad Hex")}if("object"==typeof t){if("r"in t)return"rgba("+t.r+","+t.g+","+t.b+","+e+")";if("h"in t){const s=r.hslToRgb(t.h/360,t.s,t.l);return"rgba("+s.r+","+s.g+","+s.b+","+e+")"}}else if("rgb("===t.substr(0,4))return t.substr(0,t.length-1).replace("rgb","rgba")+", "+e+")";return t}static hslToRgb(t,e,s){var r,o,i;if(0==e)r=o=i=s;else{var l=function(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t},n=s<.5?s*(1+e):s+e-s*e,a=2*s-n;r=l(a,n,t+1/3),o=l(a,n,t),i=l(a,n,t-1/3)}return{r:Math.round(255*r),g:Math.round(255*o),b:Math.round(255*i)}}static CssNamedColorToHex(t){return"red"===t?"#ff0000":"steelblue"===t?"#4682b4":"black"===t?"#000000":t}}e.default=r},function(t,e,s){"use strict";const r=(this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}})(s(2));location.search.match(/(\?|&)svg($|&)/)||new r.default,t.exports=r.default},function(t,e,s){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(s(3)),i=r(s(5)),l=r(s(0)),n=r(s(6));e.default=class{constructor(t){if(this.unassignedNodes=[],this.interactionSelections=[],this.svgAssignedAndSizeSet=!1,this.lastTenCanvasDrawTimes=[],this.enterExitQueue=[],this.safeMode=!1,this.useWorker=!0,this.getFps=(()=>{}),t&&(void 0!==t.safeMode&&(this.safeMode=t.safeMode),this.maxPixelRatio=t.maxPixelRatio,void 0!==t.useWorker&&(this.useWorker=t.useWorker),void 0!==t.getFps&&(this.getFps=t.getFps)),this.canvas=document.createElement("canvas"),"OffscreenCanvas"in window||(this.useWorker=!1),this.useWorker){this.worker=new n.default,this.worker.onmessage=(t=>{t.data&&t.data.msg&&"DRAWN"===t.data.msg&&(this.logDrawn(),this.updateCanvas())});const t=()=>{this.updateFps(),requestAnimationFrame(t)};t()}else{const t=()=>{this.updateFps(),this.logDrawn(),this.updateCanvas(),requestAnimationFrame(t)};t()}this.captureD3On(),this.setupElementsIfSvgExists(),this.canvas.addEventListener("mousedown",t=>this.propagateMouseEvent(t)),this.canvas.addEventListener("mousemove",t=>{const e=this.hoveredElement;this.hoveredElement=this.propagateMouseEvent(t),e!==this.hoveredElement&&e&&e.dispatchEvent(new MouseEvent("mouseout",t)),this.propagateMouseEvent(t,"mouseover")}),this.canvas.addEventListener("mouseup",t=>this.propagateMouseEvent(t)),this.canvas.addEventListener("click",t=>this.propagateMouseEvent(t)),this.canvas.addEventListener("wheel",t=>this.propagateWheelEvent(t)),this.replaceNativeRemoveChild(),this.replaceNativeAttribute(),this.replaceNativePathFunctions(),this.replaceNativeCreateElement(),this.replaceNativeAppendChild(),this.replaceD3Attr(),this.replaceNativeSelect(),this.replaceNativeGetComputedStyle(),this.replaceD3Select(),this.replaceD3Remove(),setTimeout(()=>{console.log(this.vdom.data)},1e3)}setupElementsIfSvgExists(t){if(this.svg)return!0;const e=t||document.getElementsByTagName("svg")[0];if(!e)return!1;const s=-1===document.location.href.indexOf("?")?"?":"&",r=document.location.href+s+"svg",i=document.createComment(" This project uses SSVG.io to render a SVG as Canvas.\r\nTo inspect the SVG, please open the following URL:\r\n"+r+"\r\n");return this.svg=e,this.svg.parentElement.appendChild(i),this.svg.parentElement.appendChild(this.canvas),this.domHandler=new o.default(this.svg,this.useWorker,this.useWorker),this.vdom=this.domHandler.getVDom(),this.setCanvasSize(),!0}updateCanvas(){this.svgAssignedAndSizeSet&&(this.useWorker?this.domHandler.useAttrQueue(t=>{0!==Object.keys(t).length?this.sendUpdateToWorker(t):setTimeout(()=>this.updateCanvas(),1)}):this.domHandler.useAttrQueue(t=>{this.renderer.updatePropertiesFromQueue&&this.renderer.updatePropertiesFromQueue(t),this.renderer.draw()}))}setCanvasSize(){if(this.svg&&this.vdom.data.width&&this.vdom.data.height){if(this.vdom.data.scale=window.devicePixelRatio,void 0!==this.maxPixelRatio&&this.vdom.data.scale>this.maxPixelRatio&&(this.vdom.data.scale=this.maxPixelRatio),this.canvas.style.width=this.vdom.data.width+"px",this.canvas.style.height=this.vdom.data.height+"px",this.canvas.width=this.vdom.data.width*this.vdom.data.scale,this.canvas.height=this.vdom.data.height*this.vdom.data.scale,this.useWorker){const t=this.canvas.transferControlToOffscreen();this.sendToWorker({cmd:"INIT",data:{canvas:t,visData:this.vdom.data,safeMode:this.safeMode}},[t])}else this.renderer=new i.default(this.vdom,this.canvas,this.safeMode,()=>{});this.svgAssignedAndSizeSet=!0}}isWithinSvg(t){let e=!1,s=t;for(;s&&s.parentNode;)s===this.svg&&(e=!0),s=s.parentNode;return e}captureD3On(){if(window.d3){const t=window.d3,e=t.selection.prototype.on,s=this;t.selection.prototype.on=function(){let t=this._parents&&this._parents.length?this._parents[0]:this[0].parentNode;t===document.children[0]&&(t=s.svg);let r=s.isWithinSvg(t);return t&&r&&-1===s.interactionSelections.indexOf(t)&&s.interactionSelections.push(t),e.apply(this,arguments)}}}replaceD3Select(){if(window.d3){const t=this,e=window.d3,s=s=>(function(r){if("string"==typeof r){let o;if(!(o=this===e?t.svg:this._groups?this._groups[0][0]:this[0][0]))return console.error("no element",this,r),s.apply(this,arguments);const i=t.domHandler.getVisNode(o);if(!i)return console.warn("node not found",o),s.apply(this,arguments);const l=t.vdom.getVisNodesFromSelector(i,r).map(e=>t.domHandler.getElementFromNode(e)),n=s.apply(this,arguments);if((n._groups?n._groups[0]:n[0]).forEach(t=>{const e=t;-1===l.indexOf(e)&&l.push()}),n._groups)n._groups[0]=l;else{const t=n[0].parentNode;n[0]=l,n[0].parentNode=t}return n}return s.apply(this,arguments)});e.selection.prototype.selectAll=s(e.selection.prototype.selectAll),e.selectAll=s(e.selectAll),e.selection.prototype.select=s(e.selection.prototype.select),e.select=s(e.select);const r=e.selection.prototype.filter;e.selection.prototype.filter=function(e){const s=this._groups?this._groups[0]:this[0];if("string"!=typeof e)return r.apply(this,arguments);let o=s[0],i=1;for(;!o&&i<s.length;)o=s[++i];const l=o?t.domHandler.getNodeFromElement(o.parentNode):null,n=s.map(e=>t.domHandler.getNodeFromElement(e)),a=e.split(",").map(t=>t.trim()),c=[];for(const e of a){const s=t.vdom.filterNodesBySelector(l,n,e);for(const t of s)-1===c.indexOf(t)&&c.push(t)}const d=c.map(e=>t.domHandler.getElementFromNode(e)),h=r.apply(this,arguments);if(h._groups)h._groups[0]=d;else{const t=h[0].parentNode;h[0]=d,h[0].parentNode=t}return h}}}replaceNativeGetComputedStyle(){const t=window.getComputedStyle,e=this;window.getComputedStyle=function(s){if(s&&!e.isWithinSvg(s)&&s!==window)return t.call(this,s);const r=e.domHandler.getNodeFromElement(s);return r?{getPropertyValue:t=>r.style[t]}:(console.warn("node not found for ",this,s),t.call(this,s))}}replaceNativeSelect(){const t=Element.prototype.querySelector,e=this;Element.prototype.querySelector=function(s){if(!e.isWithinSvg(this))return t.apply(this,arguments);const r=e.domHandler.getVisNode(this),o=e.vdom.getVisNodesFromSelector(r,s);return 0===o.length?(console.warn("could not find selection",this,r,r.globalElementIndex,s),null):e.domHandler.getElementFromNode(o[0])}}replaceD3Attr(){const t=this;function e(e,s=""){return function(r,o){if(void 0===o){if(-1!==t.unassignedNodes.indexOf(this))return e.apply(this,arguments);{const s=this._groups?this._groups[0]:this[0];if(s[0]&&!t.isWithinSvg(s[0]))return e.apply(this,arguments);if(s.length>1){const e=[];for(const o of s)e.push(t.domHandler.getAttributeFromSelector(o,r));return e}return t.domHandler.getAttributeFromSelector(s[0],r)}}{if("class"===r||!t.svg)return e.apply(this,arguments);let i=this._groups?this._groups[0]:this[0];if("object"==typeof i&&1===Object.keys(i).length&&i.parentNode){const e=i.parentNode;let s;if(e!==document.children[0]){const r=t.domHandler.getElementSelector(e);if(null===r)throw console.error("selector not found",e,i),Error("selector not found");s=t.vdom.getVisNodeFromSelector(r)}else s=t.vdom.data;i=[];for(const e of s.children)i.push(t.domHandler.getElementFromNode(e))}if(!i)return e.apply(this,arguments);const l=[];try{for(const t of i)t&&l.push(t)}catch(t){console.error(i,this),console.error(t)}if(1===l.length){const i=l[0];if(!i)return console.warn("element not found",this,r,o),this;if(!t.isWithinSvg(i))return e.apply(this,arguments);t.domHandler.queueSetAttributeOnElement(i,s+r,o)}else{if(!t.isWithinSvg(i[0]))return e.apply(this,arguments);t.domHandler.queueSetAttributeOnSelection(l,s+r,o)}return l[0]!==t.svg||"width"!==r&&"height"!==r||(t.vdom.data[r]=parseInt(o),t.setCanvasSize()),this}}}if(window.d3){const s=window.d3,r=s.selection.prototype.attr;s.selection.prototype.attr=e(r);const o=s.selection.prototype.style;s.selection.prototype.style=e(o,"style;");const i=s.selection.prototype.classed;s.selection.prototype.classed=function(e,s){if(void 0!==s){t.domHandler.enableFrontendDesignProperties();let r=this._groups?this._groups[0]:this[0],o=0;for(let i of r){if(i){const r=i.childIndex,l=i.parentSelector,n=t.vdom.getParentNodeFromSelector(l),a=n.children[r];if(!a){console.warn("node not found",i,n,r,e);continue}const c=a.className||"",d="function"==typeof s?s(i.__data__,o):s;if(!0===d){if(-1===c.indexOf(e)){let s=(c+" "+e).trim();t.domHandler.queueSetAttributeOnElement(i,"class",s)}}else if(!1===d&&-1!==c.indexOf(e)){const s=c.replace(e,"").replace("  "," ");t.domHandler.queueSetAttributeOnElement(i,"class",s),a.removedClass=e}}o++}}return i.apply(this,arguments)};const l=s.selection.prototype.transition;s.selection.prototype.transition=function(){return t.domHandler.enableFrontendDesignProperties(),l.apply(this,arguments)};const n=s.selection.prototype.text;s.selection.prototype.text=function(e){if(void 0!==e){let s=this._groups?this._groups[0]:this[0],r=0;for(let o of s){if(o&&t.isWithinSvg(o)){const s="function"==typeof e?e(o.__data__,r):e;t.domHandler.queueSetAttributeOnElement(o,"text",s)}r++}}return n.apply(this,arguments)}}}replaceD3Remove(){if(window.d3){const t=window.d3,e=this,s=this.getNewRemoveChild(()=>{},!0),r=function(){let t=this._groups?this._groups[0]:this[0];if(t.length){let r=null;for(let e=t.length-1;e>-1;e--){const o=t[e];o&&((r=o.parentNode)||console.error("element has no parent node",o),s.call(r,o))}r&&e.updateChildSelectors(r)}return this};t.selection.prototype.remove=r}}replaceNativeCreateElement(){const t=document.createElementNS,e=this;document.createElementNS=function(){let s=Array.from(arguments);const r=t.apply(this,s);return r.appendChild=e.getNewAppendChild(r.appendChild),e.unassignedNodes.push(r),r}}updateChildSelectors(t,e){const s=t.selector;s||console.error("this node has no selector",t),e||(e=this.vdom.getParentNodeFromSelector(s));for(let t=0;t<e.children.length;t++){const r=e.children[t],o=this.domHandler.getElementFromNode(r);if(!o){console.error("element not found",r,e.children.length,t);continue}const i=o.selector;o.childIndex=t,o.parentSelector=s,o.selector=this.domHandler.combineElementSelectors(s,r.type,t+1),this.domHandler.updateNodeSelector(i,o.selector),this.updateChildSelectors(o,r)}}getNewRemoveChild(t,e=!1){const s=this;return function(r){if(!this)return console.error("context not defined"),r;if(!s.isWithinSvg(r))return t.apply(this,arguments);const o=s.domHandler.getNodeFromElement(this),i=this.selector,l=s.domHandler.getNodeFromElement(r);if(!l)return console.error("node not found",l,r,this,o),t.apply(this,arguments);for(const t of l.children){const e=s.domHandler.getElementFromNode(t);r.removeChild(e)}return Object.defineProperty(r,"parentNode",{writable:!0,value:void 0}),s.enterExitQueue.push({cmd:"EXIT",childIndex:r.childIndex,parentNodeSelector:i}),s.domHandler.removeNodeFromParent(r,l),e||(i||console.error("parent not found",o,i,this,r),s.updateChildSelectors(this)),delete r.selector,r}}replaceNativeRemoveChild(){Element.prototype.removeChild=this.getNewRemoveChild(Element.prototype.removeChild)}getNewAppendChild(t){const e=this;return function(s){if(!e.svgAssignedAndSizeSet){if(e.svg||"svg"!==s.tagName)return t.apply(this,arguments);{const r=t.apply(this,arguments);return e.setupElementsIfSvgExists(s),r}}if(!e.isWithinSvg(this))return t.apply(this,arguments);Object.defineProperty(s,"ownerSVGElement",{writable:!0,value:e.svg}),s.appendChild=(r=>e.getNewAppendChild(t).call(s,r));const r=e.domHandler.getElementSelector(this);if(null===r)return t.apply(this,arguments);const o=e.domHandler.getNodeFromElement(this);if(!o)return console.error("parent node not found",r,this);let i,l=!1;if(s.parentSelector?(i=e.domHandler.getVisNode(s),e.getNewRemoveChild(()=>{}).call(this,s),l=!0):i=e.domHandler.getNodeDataFromEl(s),s.parentSelector=r,s.selector=e.domHandler.getElementSelector(s,o),s.childIndex=o.children.length,Object.defineProperty(s,"style",{writable:!0,value:{setProperty:function(t,r){e.domHandler.queueSetAttributeOnElement(s,"style;"+t,r)},getPropertyValue:function(t){return e.domHandler.enableFrontendDesignProperties(),i.style[t]}}}),Object.defineProperty(s,"parentNode",{writable:!0,value:this}),e.domHandler.linkNodeToElement(i,s),e.domHandler.addNodeToParent(o,i),e.updateChildSelectors(s,i),e.useWorker?e.enterExitQueue.push({cmd:"ENTER",node:i,parentNodeSelector:r,keepChildren:l}):e.renderer.addNode&&e.renderer.addNode(i),-1!==e.unassignedNodes.indexOf(s)){const t=e.unassignedNodes.indexOf(s);e.unassignedNodes.splice(t,1)}return s}}replaceNativeAppendChild(){const t=Element.prototype.appendChild,e=this.getNewAppendChild(t);Element.prototype.appendChild=e,Element.prototype.insertBefore=function(t,s){return e.call(this,t),t}}replaceNativePathFunctions(){const t=this,e=SVGPathElement.prototype.getTotalLength;SVGPathElement.prototype.getTotalLength=function(){if(t.isWithinSvg(this)){const e=this.getAttribute("d");t.origSetAttribute.call(this,"d",e)}return e.apply(this,arguments)}}replaceNativeAttribute(){const t=Element.prototype.setAttribute;this.origSetAttribute=t;const e=Element.prototype.setAttributeNS,s=Element.prototype.getAttribute,r=this;Element.prototype.setAttribute=function(e,s){if("easypz"!==e&&-1===r.unassignedNodes.indexOf(this)){if("class"===e&&t.apply(this,arguments),!r.isWithinSvg(this))return t.apply(this,arguments);r.domHandler.queueSetAttributeOnElement(this,e,s)}else t.apply(this,arguments)},Element.prototype.setAttributeNS=function(t,s){if("easypz"!==t&&-1===r.unassignedNodes.indexOf(this)){if("class"===t&&e.apply(this,arguments),!r.isWithinSvg(this))return e.apply(this,arguments);r.domHandler.queueSetAttributeOnElement(this,t,s)}else e.apply(this,arguments)},Element.prototype.getAttribute=function(t){if(-1!==r.unassignedNodes.indexOf(this))return s.apply(this,arguments);try{return r.domHandler.getAttributeFromSelector(this,t)}catch(t){return console.error(t),s.apply(this,arguments)}}}propagateMouseEvent(t,e){return this.propagateEvent(new MouseEvent(e||t.type,t))}propagateWheelEvent(t){return this.propagateEvent(new WheelEvent(t.type,t))}propagateEvent(t){let e;this.svg.dispatchEvent(t);for(let s of this.interactionSelections){let r=this.domHandler.getElementSelector(s),o=this.vdom.getVisNodeFromSelector(r),i=1;if(o)for(let s of o.children){let r=this.nodeAtPosition(s,t.clientX-10,t.clientY-10);if(r){const o=this.domHandler.getElementFromNode(s),i=this.domHandler.getElementFromNode(r);i&&Object.defineProperty(t,"target",{writable:!0,value:i}),i&&(e=i,i.dispatchEvent(t)),o&&(e||(e=o),o.dispatchEvent(t))}i++}}return e}nodeAtPosition(t,e,s){if("circle"===t.type){let r=t.cx||0,o=t.cy||0;if(t.transform){const e=l.default.parseTransform(t.transform);e.translateX&&(r+=e.translateX),e.translateY&&(o+=e.translateY)}return Math.sqrt(Math.pow(r-e,2)+Math.pow(o-s,2))<t.r&&t}if("rect"===t.type){let r=t.x||0,o=t.y||0;const i=t.width,n=t.height;if(t.transform){const e=l.default.parseTransform(t.transform);e.translateX&&(r+=e.translateX),e.translateY&&(o+=e.translateY)}const a=r+i/2,c=o+n/2,d=Math.abs(a-e),h=Math.abs(c-s);return d<i/2&&h<n/2&&t}if("g"===t.type){const r=this.domHandler.getTotalTransformation(t);r.translateX&&(e-=r.translateX),r.translateY&&(s-=r.translateY);let o=!1;for(let r=0;r<t.children.length;r++)this.nodeAtPosition(t.children[r],e,s)&&(o=t.children[r]);return o}return!1}logDrawn(){this.lastTenCanvasDrawTimes.push(Date.now()),this.lastTenCanvasDrawTimes.length>100&&this.lastTenCanvasDrawTimes.shift()}updateFps(){if(this.lastTenCanvasDrawTimes.length){const t=Date.now()-this.lastTenCanvasDrawTimes[0],e=Math.round(this.lastTenCanvasDrawTimes.length/t*1e3);this.getFps(e)}}sendUpdateToWorker(t){const e={cmd:"UPDATE_NODES",data:{enterExit:this.enterExitQueue,update:t}};this.sendToWorker(e),this.enterExitQueue=[]}sendToWorker(t,e){this.worker.postMessage(t,e)}}},function(t,e,s){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=s(4),i=r(s(0)),l=r(s(0));e.default=class{constructor(t,e,s=!0){this.svg=t,this.ignoreDesign=s,this.sharedArrays={},this.setAttrQueue={},this.nodesToElements={nodes:[],elements:[]},this.nodesToRestyle=[],this.useSharedArrayFor=["cx","cy","x1","x2","y1","y2","x","y"];const r={width:this.svg.getAttribute("width"),height:this.svg.getAttribute("height"),scale:1,children:[]};this.vdom=new o.VdomManager(r,s),this.svg.style.display="none",this.svg.selector="svg",this.addChildNodesToVisData(this.svg.childNodes,this.vdom.data),window.setTimeout(()=>{this.nodesToRestyle=[];for(const t of this.nodesToElements.nodes)this.nodesToRestyle.push(t)},100)}enableFrontendDesignProperties(){this.ignoreDesign=!1,this.vdom.enableFrontendDesignProperties()}getVDom(){return this.vdom}queueSetAttributeOnElement(t,e,s){const r=t.parentNode;let o=r===this.svg?"svg":t.parentSelector,i=t.childIndex;if(o||t!==this.svg||(o="SVG_PARENT",i=0),!o)return a(t,r),void console.error("selector not found");t===this.svg&&0===e.indexOf("style;")&&(e=e.substr("style;".length)),e=this.checkAttrName(o,e,!1);const l="function"==typeof s?s.call(t,t.__data__,i):s;if(this.setAttrQueue[o][e][i]=l,"className"===e||-1!==e.indexOf("style")){const s=this.getNodeFromElement(t);if("className"===e)s.className=l,this.nodesToRestyle.push(s);else{const t=e.substr(6);s.style||console.error("no styles on node ",s),s.style[t]=l}}}queueSetAttributeOnSelection(t,e,s){if(!t.length)return;if(!t[0])return;const r="SharedArrayBuffer"in self;let o=t[0].parentNode,i=this.getNodeFromElement(o),l=o===this.svg?"svg":o.selector;l||(a(t,o),console.error("selector not found")),e=this.checkAttrName(l,e,r,i);for(let n=0;n<t.length;n++){const a=t[n],c=a.childIndex;a.parentNode!==o&&(o=a.parentNode,i=this.getNodeFromElement(o),l=o===this.svg?"svg":o.selector,e=this.checkAttrName(l,e,r,i));const d="function"==typeof s?s(a.__data__,n):s;-1!==this.useSharedArrayFor.indexOf(e)&&r?this.sharedArrays[l][e][c]=10*d:this.setAttrQueue[l][e][c]=d}if("className"===e||-1!==e.indexOf("style"))for(let r=0;r<t.length;r++){const o=this.getNodeFromElement(t[r]),i="function"==typeof s?s(t[r].__data__,r):s;if("className"===e)o.className=i,this.nodesToRestyle.push(o);else{const t=e.substr(6);o.style[t]=i}}}checkAttrName(t,e,s=!1,r){if("class"===e&&(e="className"),this.setAttrQueue[t]||(this.setAttrQueue[t]={},this.sharedArrays[t]={}),s&&-1!==this.useSharedArrayFor.indexOf(e)){if(!this.sharedArrays[t][e]){r||(r=this.vdom.getParentNodeFromSelector(t));const s=r.children.length,o=new SharedArrayBuffer(Int32Array.BYTES_PER_ELEMENT*s);this.setAttrQueue[t][e]=o,this.sharedArrays[t][e]=new Int32Array(o)}}else this.setAttrQueue[t][e]||(this.setAttrQueue[t][e]=[]);return e}useAttrQueue(t=(()=>{})){this.nodesToRestyle&&this.applyStyles(),t(this.setAttrQueue),this.vdom.updatePropertiesFromQueue(this.setAttrQueue),this.setAttrQueue={}}getAttributesFromSelector(t,e){return(t._groups?t._groups[0]:t[0]).map(t=>this.getAttributeFromSelector(t,e))}getAttributeFromSelector(t,e){const s=this.getNodeFromElement(t);if(!s)throw console.error("trying to get attribute for unfit selection",s,t,e),Error("element not found");return s[e]}getVisNode(t){const e=this.getElementSelector(t);return null===e?null:this.vdom.getVisNodeFromSelector(e)}getNodeDataFromEl(t){const e=(t,e)=>{const s=t.getAttribute(e);return s?parseFloat(s):null},s={type:t.tagName.toLowerCase(),transform:t.getAttribute("transform"),d:t.getAttribute("d"),className:t.getAttribute("class"),id:t.getAttribute("id"),r:e(t,"r"),fill:t.getAttribute("fill"),cx:e(t,"cx"),cy:e(t,"cy"),x:e(t,"x"),y:e(t,"y"),x1:e(t,"x1"),x2:e(t,"x2"),y1:e(t,"y1"),y2:e(t,"y2"),"stroke-width":e(t,"stroke-width"),text:!t.childNodes||1===t.childNodes.length&&!t.childNodes[0].tagName?t.textContent:void 0,"font-size":t.getAttribute("font-size"),font:t.getAttribute("font"),"text-anchor":t.getAttribute("text-anchor"),style:{},children:[],globalElementIndex:-1};return(t=>{const e=Object.getOwnPropertyNames(t);for(let s=0;s<e.length;s++){const r=e[s];null!==t[r]&&void 0!==t[r]||delete t[r]}})(s),s}applyStyles(){for(let t=0;t<document.styleSheets.length;t++){const e=document.styleSheets[t],s=e.rules?e.rules:e.cssRules;for(let t=0;t<s.length;t++){const e=s[t],r=e.selectorText;r&&this.applyRuleToMatchingNodes(r,e)}}this.nodesToRestyle=[]}updateNodeSelector(t,e){t!==e&&(this.setAttrQueue[e]?(console.warn("having problems rearranging the elements! old:",t,", new:",e,this.setAttrQueue[t],this.setAttrQueue[e]),delete this.setAttrQueue[t]):(this.setAttrQueue[e]=this.setAttrQueue[t],delete this.setAttrQueue[t]))}applyRuleToMatchingNodes(t,e){const s=(t=t.trim()).replace(" >",">").replace("> ",">").replace("svg>","").split(" ").map(t=>t.split(">")),r=[];for(const t of this.nodesToRestyle){let e=this.getNodeParent(t);for(;e&&-1===r.indexOf(e);)r.push(e),e=this.getNodeParent(e)}const i=(t,l=0,n=0)=>{const a=s[l][n];for(let c=0;c<t.children.length;c++){const d=t.children[c];if(-1!==r.indexOf(d)||-1!==this.nodesToRestyle.indexOf(d))if(o.VdomManager.isCssRulePartialMatch(a,d,t))if(s[l].length>n+1)i(d,l,n+1);else if(s.length>l+1)i(d,l+1,n);else{const s=this.getNodeSelector(t);e.style.stroke&&(this.checkAttrName(s,"style;stroke"),this.setAttrQueue[s]["style;stroke"][c]||d.style.stroke||(this.setAttrQueue[s]["style;stroke"][c]=e.style.stroke)),e.style["stroke-opacity"]&&(this.checkAttrName(s,"style;stroke-opacity"),this.setAttrQueue[s]["style;stroke-opacity"][c]||d.style["stroke-opacity"]||(this.setAttrQueue[s]["style;stroke-opacity"][c]=e.style["stroke-opacity"])),e.style["stroke-width"]&&(this.checkAttrName(s,"style;stroke-width"),this.setAttrQueue[s]["style;stroke-width"][c]||d.style["stroke-width"]||(this.setAttrQueue[s]["style;stroke-width"][c]=parseInt(e.style["stroke-width"]))),e.style["stroke-linejoin"]&&(this.checkAttrName(s,"style;stroke-linejoin"),this.setAttrQueue[s]["style;stroke-linejoin"][c]||d.style["stroke-linejoin"]||(this.setAttrQueue[s]["style;stroke-linejoin"][c]=e.style["stroke-linejoin"])),e.style["fill-opacity"]&&(this.checkAttrName(s,"style;fill-opacity"),this.setAttrQueue[s]["style;fill-opacity"][c]||d.style["fill-opacity"]||(this.setAttrQueue[s]["style;fill-opacity"][c]=e.style["fill-opacity"])),e.style.fill&&(this.checkAttrName(s,"style;fill"),this.setAttrQueue[s]["style;fill"][c]||d.style.fill||(this.setAttrQueue[s]["style;fill"][c]=e.style.fill)),e.style.font&&(this.checkAttrName(s,"style;font"),this.setAttrQueue[s]["style;font"][c]||d.style.font||(this.setAttrQueue[s]["style;font"][c]=e.style.font))}else{if(d.removedClass){if(d.className+=" "+d.removedClass,o.VdomManager.isCssRulePartialMatch(a,d,t)){const s=this.getNodeSelector(t);this.removeRuleStylesFromNode(s,d,c,e)}d.className=d.className.substr(0,d.className.length-d.removedClass.length-1),delete d.removedClass}i(d,l,n)}}return!1};return i(this.vdom.data)}removeRuleStylesFromNode(t,e,s,r){if(r.style.stroke){const o=l.default.colorToRgba(r.style.stroke);e.style.stroke!==o&&e.style["stroke-rgba"]!==o||(this.checkAttrName(t,"style;stroke"),this.setAttrQueue[t]["style;stroke"][s]="",this.checkAttrName(t,"style;stroke-rgba"),this.setAttrQueue[t]["style;stroke-rgba"][s]="")}}removeNodeFromParent(t,e){const s=t.parentSelector,r=t.childIndex;this.vdom.removeNode(r,s);let o=this.nodesToElements.nodes.indexOf(e);if(-1===o)return console.error("node not found",e);this.nodesToElements.nodes.splice(o,1),this.nodesToElements.elements.splice(o,1);const i=t.selector;delete this.setAttrQueue[i];for(let t=o;t<this.nodesToElements.nodes.length;t++)this.nodesToElements.nodes[t].globalElementIndex=t;for(let t in this.setAttrQueue[s])for(let e=r+1;e<this.setAttrQueue[s][t].length;e++)this.setAttrQueue[s][t][e-1]=this.setAttrQueue[s][t][e]}addNodeToParent(t,e){t.children.push(e),this.nodesToRestyle.push(e)}addChildNodesToVisData(t,e){const s=this.getElementFromNode(e);for(let r=0;r<t.length;r++){let o=t[r];try{const t=this.getNodeDataFromEl(o);o.parentSelector=this.getElementSelector(s),o.selector=this.getElementSelector(o),o.childIndex=e.children.length,e.children.push(t),this.linkNodeToElement(t,o),this.nodesToRestyle.push(t),o.childNodes&&this.addChildNodesToVisData(o.childNodes,t),t.type,t.type}catch(t){}}}getNodeSelector(t){if(t===this.vdom.data)return"svg";const e=this.getElementFromNode(t);return e?this.getElementSelector(e,void 0,t):(console.error("could not find element for node ",t),"")}getElementSelector(t,e,s){let r=t.selector;if(r)return r;if(t===this.svg)r="svg";else{let o=t.parentSelector?t.parentSelector:"";if(e||(e=this.vdom.getVisNodeFromSelector(o)),!e)return console.warn("Element not found",t,o,o.length,this.vdom.data),null;let i=e.children.length+1;s&&-1!==e.children.indexOf(s)&&(i=e.children.indexOf(s)+1);let l=t.localName;if(!l)throw console.error(e),Error("name is null");l=l.toLowerCase(),r=this.combineElementSelectors(o,l,i)}return r}combineElementSelectors(t,e,s){return t+" > "+e+":nth-child("+s+")"}getNodeParent(t){if(t===this.vdom.data)return null;const e=this.getElementFromNode(t);if(!e)return null;const s=e.parentNode;return this.getNodeFromElement(s)}linkNodeToElement(t,e){this.nodesToElements.nodes.push(t),t.globalElementIndex=this.nodesToElements.elements.length,this.nodesToElements.elements.push(e)}getElementFromNode(t){return t===this.vdom.data?this.svg:this.nodesToElements.elements[t.globalElementIndex]}getNodeFromElement(t){if(t===this.svg)return this.vdom.data;const e=this.nodesToElements.elements.indexOf(t);return this.nodesToElements.nodes[e]}getParentNode(t){const e=this.getElementFromNode(t).parentNode;return this.getNodeFromElement(e)}getTotalTransformation(t){let e=this.getParentNode(t);const s=[t];for(;e;)s.push(e),e=this.getParentNode(e);e=s.pop();let r={translateX:0,translateY:0,scaleX:0,scaleY:0,rotate:0};for(;e;){const t=i.default.parseTransform(e.transform);r=i.default.addTransforms(r,t),e=s.pop()}return r}};let n=0;function a(...t){n<50&&(n++,console.log(...t))}},function(t,e,s){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(s(0));e.SetPropertyQueue=class{};class i{constructor(t,e=!1){this.data=t,this.ignoreDesign=e,this.cachedListSelections={}}enableFrontendDesignProperties(){this.ignoreDesign=!1}addNode(t,e){let s=this.getVisNodeFromSelector(e);return s||(""===e?s=this.data:console.error(s,e)),this.applyParentStyles(s,t),s&&s.children||console.error("parent node not found or no children: ",s,e,this.data),s.children.push(t),t}removeNode(t,e){let s=this.getVisNodeFromSelector(e);s||(""===e?s=this.data:console.error(s,e)),s.children.splice(t,1),this.cachedListSelections={}}applyParentStyles(t,e){for(const s in t.style)e.style[s]||(e.style[s]=t.style[s])}getParentNodeFromSelector(t){let e;return t||console.error("no parent selector",t),(e="SVG_PARENT"===t?{children:[this.data]}:this.getVisNodeFromSelector(t))||console.error("parent node not found with selector",t),e}applyStyleToNodeAndChildren(t,e,s){if(t.style[e]=s,t.children)for(let r of t.children)this.applyStyleToNodeAndChildren(r,e,s)}updatePropertiesFromQueue(t){for(let e in t){if(!t[e])continue;const s=this.getParentNodeFromSelector(e);if(s)for(let r in t[e]){const o=r.substr(0,"style;".length);if(this.ignoreDesign&&("style;"===o||-1!==["fill","stroke","opacity","x1","x2","y1","y2"].indexOf(r)))continue;let l,n;"SharedArrayBuffer"in self&&t[e][r]instanceof SharedArrayBuffer?(l=new Int32Array(t[e][r]),n=.1):l=t[e][r];for(let t in l){const e=s.children[t];if(!e)continue;let a=n?n*l[t]:l[t];if("style;"===o){const t=r.substr("style;".length);this.applyStyleToNodeAndChildren(e,t,a),this.updateDeducedStyles(e,t,a)}else-1!==i.ROUNDED_ATTRS.indexOf(r)&&(a=Math.round(a)),e[r]=a,this.updateDeducedStyles(e,r,a)}}else console.error("parent not found",e,t[e])}}updateDeducedStyles(t,e,s){if(-1!==["opacity","fill-opacity","stroke-opacity","stroke","fill"].indexOf(e)){let e=t.style.stroke?t.style.stroke:t.stroke;if(e){let s=void 0===t.style["stroke-opacity"]?t.style.opacity:t.style["stroke-opacity"];void 0===s&&(s=void 0===t["stroke-opacity"]?t.opacity:t["stroke-opacity"]),t.style["stroke-rgba"]=o.default.colorToRgba(e,s)}}}getVisNodeFromSelector(t){const e=t.lastIndexOf(">"),s=t.substr(0,e),r=t.substr(e+1),o=s?this.cachedListSelections[s]:null;let i=-1;const l=r.indexOf(":nth-child(");if(-1!==l&&(i=parseInt(r.substr(l+11)),o&&o[i]))return o[i];const n=[];if(this.findMatchingChildren(this.data,t,0,n),n&&1===n.length){const t=n[0];return-1!==i&&(this.cachedListSelections[s]||(this.cachedListSelections[s]={}),this.cachedListSelections[s][i]=t),t}return null}getVisNodesFromSelector(t,e){const s=[];return this.findMatchingChildren(t,e,0,s),s}findChildrenOfType(t,e,s){const r=t=>{for(const o of t.children)o.type===e&&s.push(o),0!==t.children.length&&r(o)};r(t)}filterNodesBySelector(t,e,s){return e.filter(e=>i.isCssRulePartialMatch(s,e,t))}findMatchingChildren(t,e,s,r,o=[]){if(!e&&""!==e)throw console.error(t,e,s,r,o),Error("undefined selector");let l=e.split(">").map(t=>t.trim()),n=l[s];if(0===s&&"svg"===n&&(n=l[++s],s===l.length))return r.push(t),void o.push(e);if(e.match(/^[a-z]+$/))return this.findChildrenOfType(t,e,r);for(let a=0;a<t.children.length;a++){let c=t.children[a],d=!1;i.isCssRulePartialMatch(n,c,t)&&(s===l.length-1?(r.push(c),o.push(e)):d=!0),c.children&&(d||l.length<2)&&s+1<l.length&&this.findMatchingChildren(c,e,s+1,r,o)}}static isCssRulePartialMatch(t,e,s){if(":not("===t.substr(0,5)){const r=t.substr(0,t.length-1).substr(5);return!i.isCssRulePartialMatch(r,e,s)}if("."===t[0]){if(e.className&&-1!==e.className.split(" ").indexOf(t.substr(1)))return!0}else if("#"===t[0]){if(t.substr(1)===e.id)return!0}else if(t.match(/^[a-z]+$/)){if(t===e.type)return!0}else{if(-1!==t.indexOf(":nth-child(")){let r="any",o=t;":"!==t[0]&&(r=t.substr(0,t.indexOf(":")),o=t.substr(t.indexOf(":")));const i=parseInt(o.substr(":nth-child(".length));return s.children.indexOf(e)===i-1&&("any"===r||e.type===r)}if(-1!==t.indexOf(".")){const s=t.indexOf("."),r=t.substr(0,s),o=t.substr(s+1);if(r===e.type&&e.className&&-1!==e.className.split(" ").indexOf(o))return!0}}return!1}}i.ROUNDED_ATTRS=["cx","cy"],e.VdomManager=i},function(t,e,s){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(s(0));e.default=class{constructor(t,e,s=!1,r=(()=>{})){this.vdom=t,this.canvas=e,this.forceSingle=s,this.onDrawn=r,this.lastFullSecond=0,this.countSinceLastFullSecond=0,this.circlesByColor={},this.rectsByColor={},this.drawTexts=[],this.linesByColor={};const o=e.getContext("2d");if(!o)throw new Error("could not create canvas context");this.ctx=o,this.ctx.scale(this.vdom.data.scale,this.vdom.data.scale),this.ctx.save(),this.draw(),setTimeout(()=>{console.log(this.forceSingle,this.vdom.data),this.draw()},1e3)}draw(){const t=this.ctx;t.restore(),t.save(),t.clearRect(0,0,this.vdom.data.width,this.vdom.data.height),this.drawLine(null,"start"),this.drawCircle(null,"start"),this.drawRect(null,"start"),this.drawText(null,"start"),this.drawNodeAndChildren(this.vdom.data,this.forceSingle),this.drawLine(null,"end"),this.drawCircle(null,"end"),this.drawRect(null,"end"),this.drawText(null,"end"),this.onDrawn();const e=Math.round(performance.now()/1e3);e!==this.lastFullSecond&&(this.lastFullSecond=e,this.countSinceLastFullSecond=0),this.countSinceLastFullSecond++}drawNodeAndChildren(t,e){const s=this.ctx;if(s.save(),this.applyTransform(t.transform),t.transform&&(e=!0),t.type&&"g"!==t.type&&(!t.style.display||"none"!==t.style.display)){if("title"===t.type)return;e?this.drawSingleNode(t,"forcesingle"):this.drawSingleNode(t)}if(t.children)for(let s=0;s<t.children.length;s++)this.drawNodeAndChildren(t.children[s],e);s.restore()}drawSingleNode(t,e="normal"){const s=t.type,r=this["draw"+s.substr(0,1).toUpperCase()+s.substr(1)];if(!r)return console.error("no draw function yet for ",s);r.call(this,t,e)}drawClippath(t){console.warn("clippaths can not be rendered yet.")}drawCircle(t,e="normal"){if("normal"===e){let e=t.style.fill?t.style.fill:t.fill,s=t.style["fill-opacity"]?t.style["fill-opacity"]:t.style.opacity;e||(e="rgb(0,0,0)");const r=o.default.colorToRgba(e,s)+";"+this.getStrokeStyle(t);this.circlesByColor[r]||(this.circlesByColor[r]=[]),this.circlesByColor[r].push(t)}if("start"!==e){if("end"!==e){if("forcesingle"===e){let e=t.style.fill?t.style.fill:t.fill;e||(e="#000");let s=t.style["fill-opacity"]?t.style["fill-opacity"]:t.style.opacity;const r=t.cx||0,i=t.cy||0;this.ctx.beginPath(),this.ctx.fillStyle=o.default.colorToRgba(e,s),this.ctx.strokeStyle=this.getStrokeStyle(t),this.ctx.lineWidth=t.style["stroke-width"]?parseFloat(t.style["stroke-width"]):parseFloat(t.strokeWidth),this.ctx.arc(r,i,t.r,0,2*Math.PI),"none"!==e&&this.ctx.fill(),t.style["stroke-rgba"]&&"none"!==t.style["stroke-rgba"]&&this.ctx.stroke()}}else for(let t in this.circlesByColor)if(this.circlesByColor.hasOwnProperty(t)){const e=t.split(";"),s=e[0],r=e[1];this.ctx.fillStyle=s;let o=this.circlesByColor[t][0];const i=o.style["stroke-width"]?parseFloat(o.style["stroke-width"]):parseFloat(o.strokeWidth);this.ctx.lineWidth=i||1,this.ctx.strokeStyle=r,this.ctx.beginPath();for(let e of this.circlesByColor[t]){const t=e.cx?e.cx:0,s=e.cy?e.cy:0,r=e.r;this.ctx.save(),this.applyTransform(e.transform),this.ctx.moveTo(t+r,s),this.ctx.arc(t,s,r,0,2*Math.PI),this.ctx.restore()}"none"!==s&&this.ctx.fill(),o.style["stroke-rgba"]&&"none"!==o.style["stroke-rgba"]&&this.ctx.stroke()}}else this.circlesByColor={}}getFillStyle(t){let e=t.style.fill?t.style.fill:t.fill,s=t.style["fill-opacity"]?t.style["fill-opacity"]:t.style.opacity;return e=o.default.colorToRgba(e,s)}getStrokeStyle(t){if(t.style["stroke-rgba"])return t.style["stroke-rgba"];let e=t.style.stroke?t.style.stroke:t.stroke;if(e){let s=void 0===t.style["stroke-opacity"]?t.style.opacity:t.style["stroke-opacity"];return void 0===s&&(s=void 0===t["stroke-opacity"]?t.opacity:t["stroke-opacity"]),t.style["stroke-rgba"]=o.default.colorToRgba(e,s),t.style["stroke-rgba"]}return"none"}drawRect(t,e="normal"){if("normal"===e){let e=t.style.fill?t.style.fill:t.fill,s=t["fill-opacity"]?t["fill-opacity"]:t.opacity,r=t.style["fill-opacity"]?t.style["fill-opacity"]:t.style.opacity;void 0!==r&&(s=r);const i=o.default.colorToRgba(e,s)+";"+this.getStrokeStyle(t);this.rectsByColor[i]||(this.rectsByColor[i]=[]),this.rectsByColor[i].push(t)}if("start"!==e){if("end"!==e){if("forcesingle"===e){let e=t.style.fill?t.style.fill:t.fill;e&&(e=o.default.colorToRgba(e,t.style["fill-opacity"])),e&&"none"!==e&&(this.ctx.fillStyle=t.style.fill?t.style.fill:t.fill,this.ctx.fillRect(t.x,t.y,t.width,t.height));let s=t.style.stroke?t.style.stroke:t.stroke;s&&(s=o.default.colorToRgba(s,t.style["stroke-opacity"]),this.ctx.strokeStyle=s,this.ctx.beginPath(),this.ctx.rect(t.x,t.y,t.width,t.height),this.ctx.stroke())}}else for(let t in this.rectsByColor)if(this.rectsByColor.hasOwnProperty(t)){const e=t.split(";"),s=e[0],r=e[1];this.ctx.fillStyle=s;let o=this.rectsByColor[t][0];const i=o.style["stroke-width"]?parseFloat(o.style["stroke-width"]):parseFloat(o.strokeWidth);this.ctx.lineWidth=i||1,this.ctx.strokeStyle=r,this.ctx.beginPath();for(let e of this.rectsByColor[t]){const t=e.cx?e.cx:0,s=e.cy?e.cy:0,r=e.r;this.ctx.save(),this.applyTransform(e.transform),this.ctx.moveTo(t+r,s),this.ctx.rect(e.x,e.y,e.width,e.height),this.ctx.restore()}"none"!==s&&this.ctx.fill(),o.style["stroke-rgba"]&&"none"!==o.style["stroke-rgba"]&&this.ctx.stroke()}}else this.rectsByColor={}}drawText(t,e="normal"){const s=t=>{if(""===t.text)return;const e=t["font-size"]?o.default.convertSizeToPx(t["font-size"])+"px":"30px";let s=t.style.font?t.style.font:t.font;if(s||(s=e+" Arial"),t["text-anchor"]){const e="middle"===t["text-anchor"]?"center":t["text-anchor"];this.ctx.textAlign=e}let r=t.fill?t.fill:t.style.fill;r||(r="#000"),this.ctx.font=s,this.ctx.fillStyle=r;let i=t.x||0,l=t.y||0,n=o.default.convertSizeToPx(t.dx,!1)||0,a=o.default.convertSizeToPx(t.dy,!1)||0;this.ctx.fillText(t.text,i+n,l+a)};if("start"!==e)if("normal"!==e){if("forcesingle"===e)return s(t);if("end"!==e);else for(const t of this.drawTexts)s(t)}else this.drawTexts.push(t);else this.drawTexts=[]}drawPath(t,e="normal"){if("normal"!==e&&"forcesingle"!==e)return;const s=this.getFillStyle(t),r=this.getStrokeStyle(t),o=t.style["stroke-width"]?t.style["stroke-width"]:t["stroke-width"];let i=new Path2D(t.d);if(this.ctx.fillStyle=s,r&&"none"!==r){if(o?(this.ctx.lineWidth=o,this.ctx.strokeStyle=r):this.ctx.strokeStyle=r,t.style["stroke-linejoin"]){const e=t.style["stroke-linejoin"];"bevel"===e||"round"===e||"miter"===e?this.ctx.lineJoin=e:console.error("unknown line join value:",e)}this.ctx.stroke(i)}s&&"none"!==s&&this.ctx.fill(i)}drawTspan(t,e="normal"){if("normal"!==e&&"forcesingle"!==e)return;this.ctx.font="10px Arial",this.ctx.fillStyle="#000000";const s="middle"===t.style.textAnchor?"center":t.style.textAnchor;this.ctx.textAlign=s,this.ctx.fillText(t.text,t.x,t.y)}drawTextpath(t){console.warn("no draw function yet for textpath")}drawLine(t,e="normal"){if(this.vdom.data.scale,"normal"===e){const e=this.getStrokeStyle(t);if("none"===e)return;this.linesByColor[e]||(this.linesByColor[e]=[]),this.linesByColor[e].push(t)}if("start"!==e){if("end"!==e)"forcesingle"===e&&(this.ctx.beginPath(),this.ctx.moveTo(t.x1,t.y1),this.ctx.lineTo(t.x2,t.y2),this.ctx.strokeStyle=t.style["stroke-rgba"],this.ctx.stroke());else for(let t in this.linesByColor)if(this.linesByColor.hasOwnProperty(t)){this.ctx.strokeStyle=t;let e=this.linesByColor[t][0];this.ctx.lineWidth=e.style["stroke-width"]?parseFloat(e.style["stroke-width"]):parseFloat(e["stroke-width"]),this.ctx.beginPath();for(let e of this.linesByColor[t])this.ctx.save(),this.applyTransform(e.transform),this.ctx.moveTo(e.x1,e.y1),this.ctx.lineTo(e.x2,e.y2),this.ctx.restore();this.ctx.stroke()}}else this.linesByColor={}}drawDefs(t){}drawMarker(t){}applyTransform(t){const e=t?o.default.parseTransform(t):null;return!!e&&(e.rotate,this.ctx.transform(e.scaleX,0,0,e.scaleY,e.translateX,e.translateY),this.ctx.rotate(e.rotate*Math.PI/180),!0)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),s(7);const r=s(8);e.default=r},function(t,e){},function(t,e,s){t.exports=function(){return s(9)('!function(t){var e={};function s(r){if(e[r])return e[r].exports;var l=e[r]={i:r,l:!1,exports:{}};return t[r].call(l.exports,l,l.exports,s),l.l=!0,l.exports}s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var l in t)s.d(r,l,function(e){return t[e]}.bind(null,l));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{static parseTransform(t){const e={translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0,translateBeforeScale:!1};if(t){if("string"!=typeof t)return e.scaleX=t.k,e.scaleY=t.k,e.translateX=t.x,e.translateY=t.y,e;let s=t;s=s.replace(/ /g,"");const r=/\\s*translate\\(([-0-9.]+),([-0-9.]+)\\)/.exec(s);r&&(e.translateX=parseFloat(r[1]),e.translateY=parseFloat(r[2]));const l=/\\s*scale\\(([-0-9.]+)\\)/.exec(s);l&&(e.scaleX=parseFloat(l[1]),e.scaleY=parseFloat(l[1]));const o=/\\s*rotate\\(([-0-9.]+)\\)/.exec(s);o&&(e.rotate=parseFloat(o[1])),/\\s*translate\\(([-0-9.]+),([-0-9.]+)\\)scale\\(([-0-9.]+)\\)/.exec(s)&&(e.translateBeforeScale=!0);const i=/\\s*matrix\\(([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+)\\)/.exec(s);i&&(e.scaleX=parseFloat(i[1]),e.scaleY=parseFloat(i[4]),e.translateX=parseFloat(i[5]),e.translateY=parseFloat(i[6]))}return e}static addTransforms(t,e){return{translateX:t.translateX+e.translateX,translateY:t.translateY+e.translateY,scaleX:t.scaleX*e.scaleX,scaleY:t.scaleY*e.scaleY,rotate:t.rotate+e.rotate}}static convertSizeToPx(t,e=!0){const s=e?14:void 0;return void 0===t?s:"number"==typeof t?t:"em"===t.substr(-2)?Math.round(12*parseFloat(t)):"px"===t.substr(-2)?parseInt(t):t.match(/^[0-9]+$/)?parseInt(t):(console.warn("size in unsupported format: ",t),s)}static colorToRgba(t,e=1){if(!t||"none"===t)return"none";if(t=r.CssNamedColorToHex(t),1===e&&"string"==typeof t)return t;if("string"==typeof t&&"#"===t[0]){let s;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return 3==(s=t.substring(1)).length&&(s=s[0]+s[0]+s[1]+s[1]+s[2]+s[2]),"rgba("+[(s="0x"+s)>>16&255,s>>8&255,255&s].join(",")+","+e+")";throw new Error("Bad Hex")}if("object"==typeof t){if("r"in t)return"rgba("+t.r+","+t.g+","+t.b+","+e+")";if("h"in t){const s=r.hslToRgb(t.h/360,t.s,t.l);return"rgba("+s.r+","+s.g+","+s.b+","+e+")"}}else if("rgb("===t.substr(0,4))return t.substr(0,t.length-1).replace("rgb","rgba")+", "+e+")";return t}static hslToRgb(t,e,s){var r,l,o;if(0==e)r=l=o=s;else{var i=function(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t},n=s<.5?s*(1+e):s+e-s*e,a=2*s-n;r=i(a,n,t+1/3),l=i(a,n,t),o=i(a,n,t-1/3)}return{r:Math.round(255*r),g:Math.round(255*l),b:Math.round(255*o)}}static CssNamedColorToHex(t){return"red"===t?"#ff0000":"steelblue"===t?"#4682b4":"black"===t?"#000000":t}}e.default=r},function(t,e,s){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=s(2),o=r(s(3));let i;const n=self;let a;n.onmessage=function(t){const e=t.data;if(e&&e.cmd)switch(e.cmd){case"INIT":a=new l.VdomManager(e.data.visData);const t=!!e.data.safeMode;i=new o.default(a,e.data.canvas,t,()=>{n.postMessage({msg:"DRAWN"})});break;case"UPDATE_NODES":const s=e;for(let t of s.data.enterExit)if("ENTER"===t.cmd){t.keepChildren||(t.node.children=[]);const e=a.addNode(t.node,t.parentNodeSelector);i.addNode&&i.addNode(e)}else"EXIT"===t.cmd&&a.removeNode(t.childIndex,t.parentNodeSelector);i.updatePropertiesFromQueue?i.updatePropertiesFromQueue(s.data.update):a.updatePropertiesFromQueue(s.data.update),i.draw();break;default:console.error("did not find command ",e.cmd)}}},function(t,e,s){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=r(s(0));e.SetPropertyQueue=class{};class o{constructor(t,e=!1){this.data=t,this.ignoreDesign=e,this.cachedListSelections={}}enableFrontendDesignProperties(){this.ignoreDesign=!1}addNode(t,e){let s=this.getVisNodeFromSelector(e);return s||(""===e?s=this.data:console.error(s,e)),this.applyParentStyles(s,t),s&&s.children||console.error("parent node not found or no children: ",s,e,this.data),s.children.push(t),t}removeNode(t,e){let s=this.getVisNodeFromSelector(e);s||(""===e?s=this.data:console.error(s,e)),s.children.splice(t,1),this.cachedListSelections={}}applyParentStyles(t,e){for(const s in t.style)e.style[s]||(e.style[s]=t.style[s])}getParentNodeFromSelector(t){let e;return t||console.error("no parent selector",t),(e="SVG_PARENT"===t?{children:[this.data]}:this.getVisNodeFromSelector(t))||console.error("parent node not found with selector",t),e}applyStyleToNodeAndChildren(t,e,s){if(t.style[e]=s,t.children)for(let r of t.children)this.applyStyleToNodeAndChildren(r,e,s)}updatePropertiesFromQueue(t){for(let e in t){if(!t[e])continue;const s=this.getParentNodeFromSelector(e);if(s)for(let r in t[e]){const l=r.substr(0,"style;".length);if(this.ignoreDesign&&("style;"===l||-1!==["fill","stroke","opacity","x1","x2","y1","y2"].indexOf(r)))continue;let i,n;"SharedArrayBuffer"in self&&t[e][r]instanceof SharedArrayBuffer?(i=new Int32Array(t[e][r]),n=.1):i=t[e][r];for(let t in i){const e=s.children[t];if(!e)continue;let a=n?n*i[t]:i[t];if("style;"===l){const t=r.substr("style;".length);this.applyStyleToNodeAndChildren(e,t,a),this.updateDeducedStyles(e,t,a)}else-1!==o.ROUNDED_ATTRS.indexOf(r)&&(a=Math.round(a)),e[r]=a,this.updateDeducedStyles(e,r,a)}}else console.error("parent not found",e,t[e])}}updateDeducedStyles(t,e,s){if(-1!==["opacity","fill-opacity","stroke-opacity","stroke","fill"].indexOf(e)){let e=t.style.stroke?t.style.stroke:t.stroke;if(e){let s=void 0===t.style["stroke-opacity"]?t.style.opacity:t.style["stroke-opacity"];void 0===s&&(s=void 0===t["stroke-opacity"]?t.opacity:t["stroke-opacity"]),t.style["stroke-rgba"]=l.default.colorToRgba(e,s)}}}getVisNodeFromSelector(t){const e=t.lastIndexOf(">"),s=t.substr(0,e),r=t.substr(e+1),l=s?this.cachedListSelections[s]:null;let o=-1;const i=r.indexOf(":nth-child(");if(-1!==i&&(o=parseInt(r.substr(i+11)),l&&l[o]))return l[o];const n=[];if(this.findMatchingChildren(this.data,t,0,n),n&&1===n.length){const t=n[0];return-1!==o&&(this.cachedListSelections[s]||(this.cachedListSelections[s]={}),this.cachedListSelections[s][o]=t),t}return null}getVisNodesFromSelector(t,e){const s=[];return this.findMatchingChildren(t,e,0,s),s}findChildrenOfType(t,e,s){const r=t=>{for(const l of t.children)l.type===e&&s.push(l),0!==t.children.length&&r(l)};r(t)}filterNodesBySelector(t,e,s){return e.filter(e=>o.isCssRulePartialMatch(s,e,t))}findMatchingChildren(t,e,s,r,l=[]){if(!e&&""!==e)throw console.error(t,e,s,r,l),Error("undefined selector");let i=e.split(">").map(t=>t.trim()),n=i[s];if(0===s&&"svg"===n&&(n=i[++s],s===i.length))return r.push(t),void l.push(e);if(e.match(/^[a-z]+$/))return this.findChildrenOfType(t,e,r);for(let a=0;a<t.children.length;a++){let c=t.children[a],h=!1;o.isCssRulePartialMatch(n,c,t)&&(s===i.length-1?(r.push(c),l.push(e)):h=!0),c.children&&(h||i.length<2)&&s+1<i.length&&this.findMatchingChildren(c,e,s+1,r,l)}}static isCssRulePartialMatch(t,e,s){if(":not("===t.substr(0,5)){const r=t.substr(0,t.length-1).substr(5);return!o.isCssRulePartialMatch(r,e,s)}if("."===t[0]){if(e.className&&-1!==e.className.split(" ").indexOf(t.substr(1)))return!0}else if("#"===t[0]){if(t.substr(1)===e.id)return!0}else if(t.match(/^[a-z]+$/)){if(t===e.type)return!0}else{if(-1!==t.indexOf(":nth-child(")){let r="any",l=t;":"!==t[0]&&(r=t.substr(0,t.indexOf(":")),l=t.substr(t.indexOf(":")));const o=parseInt(l.substr(":nth-child(".length));return s.children.indexOf(e)===o-1&&("any"===r||e.type===r)}if(-1!==t.indexOf(".")){const s=t.indexOf("."),r=t.substr(0,s),l=t.substr(s+1);if(r===e.type&&e.className&&-1!==e.className.split(" ").indexOf(l))return!0}}return!1}}o.ROUNDED_ATTRS=["cx","cy"],e.VdomManager=o},function(t,e,s){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=r(s(0));e.default=class{constructor(t,e,s=!1,r=(()=>{})){this.vdom=t,this.canvas=e,this.forceSingle=s,this.onDrawn=r,this.lastFullSecond=0,this.countSinceLastFullSecond=0,this.circlesByColor={},this.rectsByColor={},this.drawTexts=[],this.linesByColor={};const l=e.getContext("2d");if(!l)throw new Error("could not create canvas context");this.ctx=l,this.ctx.scale(this.vdom.data.scale,this.vdom.data.scale),this.ctx.save(),this.draw(),setTimeout(()=>{console.log(this.forceSingle,this.vdom.data),this.draw()},1e3)}draw(){const t=this.ctx;t.restore(),t.save(),t.clearRect(0,0,this.vdom.data.width,this.vdom.data.height),this.drawLine(null,"start"),this.drawCircle(null,"start"),this.drawRect(null,"start"),this.drawText(null,"start"),this.drawNodeAndChildren(this.vdom.data,this.forceSingle),this.drawLine(null,"end"),this.drawCircle(null,"end"),this.drawRect(null,"end"),this.drawText(null,"end"),this.onDrawn();const e=Math.round(performance.now()/1e3);e!==this.lastFullSecond&&(this.lastFullSecond=e,this.countSinceLastFullSecond=0),this.countSinceLastFullSecond++}drawNodeAndChildren(t,e){const s=this.ctx;if(s.save(),this.applyTransform(t.transform),t.transform&&(e=!0),t.type&&"g"!==t.type&&(!t.style.display||"none"!==t.style.display)){if("title"===t.type)return;e?this.drawSingleNode(t,"forcesingle"):this.drawSingleNode(t)}if(t.children)for(let s=0;s<t.children.length;s++)this.drawNodeAndChildren(t.children[s],e);s.restore()}drawSingleNode(t,e="normal"){const s=t.type,r=this["draw"+s.substr(0,1).toUpperCase()+s.substr(1)];if(!r)return console.error("no draw function yet for ",s);r.call(this,t,e)}drawClippath(t){console.warn("clippaths can not be rendered yet.")}drawCircle(t,e="normal"){if("normal"===e){let e=t.style.fill?t.style.fill:t.fill,s=t.style["fill-opacity"]?t.style["fill-opacity"]:t.style.opacity;e||(e="rgb(0,0,0)");const r=l.default.colorToRgba(e,s)+";"+this.getStrokeStyle(t);this.circlesByColor[r]||(this.circlesByColor[r]=[]),this.circlesByColor[r].push(t)}if("start"!==e){if("end"!==e){if("forcesingle"===e){let e=t.style.fill?t.style.fill:t.fill;e||(e="#000");let s=t.style["fill-opacity"]?t.style["fill-opacity"]:t.style.opacity;const r=t.cx||0,o=t.cy||0;this.ctx.beginPath(),this.ctx.fillStyle=l.default.colorToRgba(e,s),this.ctx.strokeStyle=this.getStrokeStyle(t),this.ctx.lineWidth=t.style["stroke-width"]?parseFloat(t.style["stroke-width"]):parseFloat(t.strokeWidth),this.ctx.arc(r,o,t.r,0,2*Math.PI),"none"!==e&&this.ctx.fill(),t.style["stroke-rgba"]&&"none"!==t.style["stroke-rgba"]&&this.ctx.stroke()}}else for(let t in this.circlesByColor)if(this.circlesByColor.hasOwnProperty(t)){const e=t.split(";"),s=e[0],r=e[1];this.ctx.fillStyle=s;let l=this.circlesByColor[t][0];const o=l.style["stroke-width"]?parseFloat(l.style["stroke-width"]):parseFloat(l.strokeWidth);this.ctx.lineWidth=o||1,this.ctx.strokeStyle=r,this.ctx.beginPath();for(let e of this.circlesByColor[t]){const t=e.cx?e.cx:0,s=e.cy?e.cy:0,r=e.r;this.ctx.save(),this.applyTransform(e.transform),this.ctx.moveTo(t+r,s),this.ctx.arc(t,s,r,0,2*Math.PI),this.ctx.restore()}"none"!==s&&this.ctx.fill(),l.style["stroke-rgba"]&&"none"!==l.style["stroke-rgba"]&&this.ctx.stroke()}}else this.circlesByColor={}}getFillStyle(t){let e=t.style.fill?t.style.fill:t.fill,s=t.style["fill-opacity"]?t.style["fill-opacity"]:t.style.opacity;return e=l.default.colorToRgba(e,s)}getStrokeStyle(t){if(t.style["stroke-rgba"])return t.style["stroke-rgba"];let e=t.style.stroke?t.style.stroke:t.stroke;if(e){let s=void 0===t.style["stroke-opacity"]?t.style.opacity:t.style["stroke-opacity"];return void 0===s&&(s=void 0===t["stroke-opacity"]?t.opacity:t["stroke-opacity"]),t.style["stroke-rgba"]=l.default.colorToRgba(e,s),t.style["stroke-rgba"]}return"none"}drawRect(t,e="normal"){if("normal"===e){let e=t.style.fill?t.style.fill:t.fill,s=t["fill-opacity"]?t["fill-opacity"]:t.opacity,r=t.style["fill-opacity"]?t.style["fill-opacity"]:t.style.opacity;void 0!==r&&(s=r);const o=l.default.colorToRgba(e,s)+";"+this.getStrokeStyle(t);this.rectsByColor[o]||(this.rectsByColor[o]=[]),this.rectsByColor[o].push(t)}if("start"!==e){if("end"!==e){if("forcesingle"===e){let e=t.style.fill?t.style.fill:t.fill;e&&(e=l.default.colorToRgba(e,t.style["fill-opacity"])),e&&"none"!==e&&(this.ctx.fillStyle=t.style.fill?t.style.fill:t.fill,this.ctx.fillRect(t.x,t.y,t.width,t.height));let s=t.style.stroke?t.style.stroke:t.stroke;s&&(s=l.default.colorToRgba(s,t.style["stroke-opacity"]),this.ctx.strokeStyle=s,this.ctx.beginPath(),this.ctx.rect(t.x,t.y,t.width,t.height),this.ctx.stroke())}}else for(let t in this.rectsByColor)if(this.rectsByColor.hasOwnProperty(t)){const e=t.split(";"),s=e[0],r=e[1];this.ctx.fillStyle=s;let l=this.rectsByColor[t][0];const o=l.style["stroke-width"]?parseFloat(l.style["stroke-width"]):parseFloat(l.strokeWidth);this.ctx.lineWidth=o||1,this.ctx.strokeStyle=r,this.ctx.beginPath();for(let e of this.rectsByColor[t]){const t=e.cx?e.cx:0,s=e.cy?e.cy:0,r=e.r;this.ctx.save(),this.applyTransform(e.transform),this.ctx.moveTo(t+r,s),this.ctx.rect(e.x,e.y,e.width,e.height),this.ctx.restore()}"none"!==s&&this.ctx.fill(),l.style["stroke-rgba"]&&"none"!==l.style["stroke-rgba"]&&this.ctx.stroke()}}else this.rectsByColor={}}drawText(t,e="normal"){const s=t=>{if(""===t.text)return;const e=t["font-size"]?l.default.convertSizeToPx(t["font-size"])+"px":"30px";let s=t.style.font?t.style.font:t.font;if(s||(s=e+" Arial"),t["text-anchor"]){const e="middle"===t["text-anchor"]?"center":t["text-anchor"];this.ctx.textAlign=e}let r=t.fill?t.fill:t.style.fill;r||(r="#000"),this.ctx.font=s,this.ctx.fillStyle=r;let o=t.x||0,i=t.y||0,n=l.default.convertSizeToPx(t.dx,!1)||0,a=l.default.convertSizeToPx(t.dy,!1)||0;this.ctx.fillText(t.text,o+n,i+a)};if("start"!==e)if("normal"!==e){if("forcesingle"===e)return s(t);if("end"!==e);else for(const t of this.drawTexts)s(t)}else this.drawTexts.push(t);else this.drawTexts=[]}drawPath(t,e="normal"){if("normal"!==e&&"forcesingle"!==e)return;const s=this.getFillStyle(t),r=this.getStrokeStyle(t),l=t.style["stroke-width"]?t.style["stroke-width"]:t["stroke-width"];let o=new Path2D(t.d);if(this.ctx.fillStyle=s,r&&"none"!==r){if(l?(this.ctx.lineWidth=l,this.ctx.strokeStyle=r):this.ctx.strokeStyle=r,t.style["stroke-linejoin"]){const e=t.style["stroke-linejoin"];"bevel"===e||"round"===e||"miter"===e?this.ctx.lineJoin=e:console.error("unknown line join value:",e)}this.ctx.stroke(o)}s&&"none"!==s&&this.ctx.fill(o)}drawTspan(t,e="normal"){if("normal"!==e&&"forcesingle"!==e)return;this.ctx.font="10px Arial",this.ctx.fillStyle="#000000";const s="middle"===t.style.textAnchor?"center":t.style.textAnchor;this.ctx.textAlign=s,this.ctx.fillText(t.text,t.x,t.y)}drawTextpath(t){console.warn("no draw function yet for textpath")}drawLine(t,e="normal"){if(this.vdom.data.scale,"normal"===e){const e=this.getStrokeStyle(t);if("none"===e)return;this.linesByColor[e]||(this.linesByColor[e]=[]),this.linesByColor[e].push(t)}if("start"!==e){if("end"!==e)"forcesingle"===e&&(this.ctx.beginPath(),this.ctx.moveTo(t.x1,t.y1),this.ctx.lineTo(t.x2,t.y2),this.ctx.strokeStyle=t.style["stroke-rgba"],this.ctx.stroke());else for(let t in this.linesByColor)if(this.linesByColor.hasOwnProperty(t)){this.ctx.strokeStyle=t;let e=this.linesByColor[t][0];this.ctx.lineWidth=e.style["stroke-width"]?parseFloat(e.style["stroke-width"]):parseFloat(e["stroke-width"]),this.ctx.beginPath();for(let e of this.linesByColor[t])this.ctx.save(),this.applyTransform(e.transform),this.ctx.moveTo(e.x1,e.y1),this.ctx.lineTo(e.x2,e.y2),this.ctx.restore();this.ctx.stroke()}}else this.linesByColor={}}drawDefs(t){}drawMarker(t){}applyTransform(t){const e=t?l.default.parseTransform(t):null;return!!e&&(e.rotate,this.ctx.transform(e.scaleX,0,0,e.scaleY,e.translateX,e.translateY),this.ctx.rotate(e.rotate*Math.PI/180),!0)}}}]);\n//# sourceMappingURL=5d004582219887303271.worker.js.map',s.p+"5d004582219887303271.worker.js")}},function(t,e,s){"use strict";var r=window.URL||window.webkitURL;t.exports=function(t,e){try{try{var s;try{(s=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),s=s.getBlob()}catch(e){s=new Blob([t])}return new Worker(r.createObjectURL(s))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(t){if(!e)throw Error("Inline worker is not supported");return new Worker(e)}}}])});
//# sourceMappingURL=ssvg-auto.js.map