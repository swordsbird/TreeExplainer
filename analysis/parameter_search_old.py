tickers = 'KIRK,CASI,CAMP,NLTX,AGLE,XXII,EIGR,FPAY,CYN,EMKR,CRBP,BMTX,OSA,APRN,KALA,SYBX,AWRE,CADL,SNSE,ZDGE,ATIP,SUNL,HARP,AIM,AINC,UPH,EQ,UTRS,SBEV,BTCM,SLNO,RPID,ARMP,HYFM,CXDO,USAU,AGIL,PAVM,SPI,WKEY,AZYO,PHUN,BWAY,HHS,EDRY,NLS,ICD,OWLT,STRC,DPRO,BCEL,FTEK,IMPL,DRCT,CODX,DERM,CSSE,ORGS,UP,GRIL,WMC,VWE,NXTC,MIRO,FATH,RVLP,USIO,IDN,YELL,DUOT,XGN,RWLK,UPXI,CCLD,DXR,TSHA,JOAN,WKSP,CNTG,UBX,JRSH,SABS,KAVL,INDO,BFI,BYSI,LNSR,SOHO,SIEN,LUCD,RSSS,PFIE,STIM,HSON,OSS,DCTH,FARM,VRAR,ICCM,ASMB,ICAD,HLGN,LOAN,FURY,BCDA,POL,CZOO,CURI,HOFV,OESX,GANX,APPH,FLNT,GORO,BIOR,VIRX,SGTX,LVTX,DYAI,RAIL,FIXX,PASG,AKA,CRDL,SANW,BOLT,EFTR,AIRG,TOI,TOON,ISDR,SCOR,FBIO,XOS,VFF,LODE,LGVN,AXDX,CLSD,LINK,LPTH,CURO,HOOK,AEYE,SONX,PDEX,ADAG,SYRS,HLTH,SNDA,SURG,OMIC,GLTO,IPWR,CRDF,RBT,CLNN,AVRO,NSPR,CELL,VACC,SSSS,SNCR,BSGM,BZFD,SOLO,VTSI,BWEN,SCTL,OCUP,SPRB,APEI,VNRX,GMGI,APLT,MTNB,SLGL,ETON,CLGN,GAN,DBTX,USAS,MLSS,PET,TIL,HCWB,STRM,QUBT,FLUX,LEE,DARE,DTIL,ACR,SND,IPA,PPSI,FUNC,CMLS,MESA,LFT,FNWD,CZWI,KITT,ORTX,CODA,SCYX,PCTI,DOMA,AREN,AFMD,IVAC,LWAY,KULR,ELMD,PXLW,CELU,UCL,HITI,PROV,BDSX,ARAV,DLNG,ACNT,AKLI,RAD,AQST,MDWD,TACT,KLR,ACU,TKNO,RLMD,MCHX,EGLX,ASM,CMCT,LAKE,VERU,TBNK,SPIR,RVSB,HRTG,LIFE,GLYC,NKTR,CGEN,LVLU,CONN,PSNL,PWFL,CMRX,DMTK,DRIO,VOXR,NPCE,TCRX,EBMT,VXRT,BFIN,LUXH,CBFV,QMCO,PFSW,BGSF,XTNT,SUP,NEOV,FFNW,ASTR,ORN,GNSS,CRIS,IMNM,NTIC,NKTX,NIR,CLPR,FSFG,MDWT,CDTX,SLDB,MDXH,QUIK,AQMS,AXTI,CDXC,DRRX,DZSI,LCUT,KRON,MITT,CTMX,KORE,ADCT,PRPH,GRTX,STXS,TCRT,PAYS,SRT,ASXC,NNBR,ISPO,MIST,BHG,AOUT,CASA,HOWL,ACHV,ATHA,STTK,PHX,ISTR,SQNS,RGF,IMUX,FNWB,FAT,CPTN,FINW,ALLT,CAPR,MVLA,CHMI,DMAC,WPRT,INBK,OCFT,DLHC,UPLD,MAPS,KRMD,BCAB,AHT,BSET,HGBL,PRQR,PRCH,ORMP,MMMB,OPBK,USAP,EVBN,HMST,ASYS,YTRA,WNEB,CALB,AAIC,BODY,ZFOX,TZOO,PLBY,FTHM,RENT,LL,FCCO,SGA,NGS,TALS,WMPN,NOTV,SOND,CLLS,FGBI,PRTK,GTHX,SY,ALT,CTV,LAZY,IH,ZVRA,STIX,AREC,RCMT,LVO,QBTS,HRTX,FEAM,TCS,SACH,DIBS,LMDX,PDSB,GOSS,RCKY,ESPR,PBYI,ANTX,SEVN,VERI,FSTR,ESEA,KNTE,ADAP,EGIO,OCGN,LFMD,AADI,CTRN,LYRA,ROOT,CARA,QRHC,CDRO,IVVD,NDLS,BEEM,ACET,FVCB,LAB,KLXE,CVCY,CSTE,OPT,KZR,MTRX,WGS,TGAN,MRCC,BLZE,INMB,RMBL,BDTX,IPSC,LPTV,MYFW,CATX,IVA,CRMD,CCCC,GASS,POET,SELB,ALYA,DCFC,ABSI,DHX,PCYG,CBAN,BCOV,CRGO,PRST,NINE,LTRX,PSTX,NKSH,HYPR,ITI,FREE,ARQQ,FSP,SEEL,AJX,EMAN,RNLX,CLPT,HNST,IMMP,AKBA,FRST,CELC,EMX,AOMR,SWKH,BCML,ORRF,ADVM,AMSC,TRUE,BZUN,CDXS,ATRA,GNFT,ANNX,CMT,ELA,TSQ,PFMT,OPRT,INFU,ATLX,PEPG,SFST,JYNT,APYX,WISH,AKTS,VOR,BCBP,ACB,CRNT,CCRD,HEAR,VRA,RDW,INVE,LINC,WKHS,CUE,ONCY,BWFG,MRAM,KNOP,GRTS,BIRD,XOMA,ATNM,CVLY,KPTI,GTE,TLS,LCTX,RRGB,HBIO,RBB,OVID,AGS,PMTS,STKS,PPTA,ARBE,ACTG,FFWM,KOPN,MEC,FENC,FSBW,EGRX,MG,SKIL,UTI,IMMR,SKYX,EHTH,RBOT,OUST,CNTY,TLYS,PINE,CIO,FULC,FLL,OCN,SPWH,VSTM,GRWG,TIO,EGAN,TRHC,RGTI,TALK,RIGL,DLTH,URGN,TCBX,VOXX,BSVN,PCB,CLMB,NECB,PRLD,NYXH,FRBA,SLN,OPFI,USCB,ATOM,BGFV,LSAK,FRGI,NSTG,RLYB,FLIC,BARK,NREF,AIP,ACNB,IKNA,CIVB,BHIL,BKSY,IMRX,EEX,ACRV,PLSE,GROY,BCAL,BLFY,CSTR,PRTS,AFCG,FGEN,ACIU,III,NATR,CBNK,BSRR,BHR,POWW,NUTX,EVER,THRN,ASUR,URG,TDUP,OPRX,VLN,IPHA,FISI,WRN,SKLZ,RNGR,TLIS,CMTL,INTT,SOL,MTA,QUAD,SILC,TELA,ILPT,SGMO,MOLN,CMCL,LVOX,FBIZ,TUSK,XFOR,LFCR,CZNC,BLDE,CVEO,AEVA,SCM,CURV,SSTI,FARO,PGEN,DSP,SOPH,PRTH,PTRA,RYAM,CDLX,KLTR,ASRT,DNMR,LGO,ADSE,BMRC,TAST,FUSN,SAMG,BVS,GPMT,VRCA,ZVIA,SDC,AVAH,STRO,ALTO,LLAP,LE,ZIMV,OMGA,LMNR,PETS,HBCP,REFI,MVBF,NGM,BWB,GHL,OB,ALXO,LMB,GCO,TREE,CWCO,RLGT,CZFS,KALV,XERS,DSKE,OMER,BBW,GATO,CVRX,EDAP,AUDC,ATAI,BBAI,TCX,FHTX,GPP,MGNX,BTBT,IPI,HUMA,WSBF,GNTY,RM,EYPT,SLQT,CUTR,SEER,TNGX,LUNA,YMAB,AVIR,SCPH,NWPX,SAR,CMAX,TWOU,WTBA,GWH,FMAO,BLND,DXLG,HT,ESQ,FFIC,IBCP,ARAY,FLGC,INSE,CGNT,EQBK,GILT,AVNW,ALRS,SGHT,PACK,HYLN,FTCI,KRT,GHI,OLMA,CVGI,OCUL,CARM,LXFR,VUZI,CARE,CPSI,AMSWA,GLUE,API,MYTE,ZUMZ,LYTS,HQI,CLAR,PNTG,VMD,PSTL,BOOM,NBN,ODV,AKYA,DOYU,UIS,DBVT,NN,MGTX,NIU,MOFG,NVTA,SVRA,QSI,PLCE,ZYXI,PRPL,CHRS,IGIC,EOLS,VLD,CMBM,ERAS,LSEA,BLNK,SOI,ALLK,GOCO,ENTA,REI,VCSA,FRGE,CGEM,WVE,SLND,THFF,ALVR,PNNT,HIPO,ONTF,EVC,GEVO,DSX,SPFI,NEWT,AXGN,SOHU,CTO,GCI,BRLT,NEWP,BFST,SKYT,FSBC,BLUE,SHBI,GLAD,AMRS,OPI,ONL,VEL,DSGN,RSVR,IREN,MUX,KOD,ANIK,BAND,SB,SRRK,IBEX,QUOT,BRT,NUVB,BHB,SMBK,ABUS,OOMA,HTBI,TNYA,EBS,LOCO,OPAD,TIGR,BFLY,IGMS,MSBI,ICPT,UVE,RPTX,TARS,AURA,CECO,MBWM,PETQ,BWMN,WASH,SMBC,TERN,GBIO,MCB,GAIN,BITF,VITL,AAN,CERS,STOK,BBCP,OTLK,CLOV,OLP,BKKT,JMIA,OCS,RMNI,RCEL,TPB,VNET,CPF,AUTL,MRSN,TPIC,LOVE,NTGR,SENS,TPVG,GAMB,HDSN,MX,NEGG,TGB,SRDX,VYGR,DESP,ALEC,MCFT,PHVS,TRDA,EGHT,NOA,HVT,CFB,CCB,QNST,FMBH,TRIN,SMWB,MTLS,NFBK,IHRT,LUNG,NOTE,FLWS,LQDT,COOK,AMAL,ITOS,AVTE,NETI,SWIM,AMRN,CSV,VPG,NGL,ALPN,SLDP,PGC,LQDA,SST,HAFC,QRTEA,LEV,METC,BWMX,RBBN,MRNS,CNSL,HIVE,SFIX,MITK,FATE,ICVX,WSR,KRNY,NRGV,HIBB,EZPW,CSTL,CAN,CABA,ORGO,MBI,FMNB,CLDT,EWTX,TRVG,INVZ,ITRN,HBNC,MCS,IVR,FC,TCMD,ATLC,PAHC,CTLP,FORR,CCAP,HFWA,ARQT,LAND,MCRB,ATEX,DAO,GNK,IRMD,UFCS,DM,MKTW,ONEW,PERF,VVI,BRY,BW,TBPH,OABI,XPER,OSPN,WE,ACRE,ATNI,LXRX,AMCX,TRTX,CDNA,CVLG,CLW,LEGH,HROW,TSVT,DOMO,TBI,RXT,CCBG,HSII,LIND,TNP,SRI,OBE,ALTG,SVM,ANAB,TRMR,ZYME,GLDD,UVSP,AIRS,CMPO,LAW,AGX,GOOD,ASC,SRG,CVGW,DTC,PFLT,VINP,QURE,OIS,HTBK,JANX,TILE,VTRU,EOSE,GHLD,SNBR,LDI,PLOW,MTW,TYRA,GMRE,DYN,DX,VTS,AMPX,GPRO,WULF,MLAB,DCO,JRVR,BCYC,FPI,CCSI,CNOB,AGEN,SCVL,TRNS,PBI,TCPC,BVH,RICK,DENN,AORT,TSE,HAYN,GSBC,MYPS,DDL,SCWX,WW,SPRY,AMTB,HLLY,EGLE,MGIC,AMOT,LANV,KELYA,PFC,EXFY,SHCR,CYH,EHAB,AMWL,EXK,SWBI,NEXA,VTNR,MOND,ORGN,ATRO,RMAX,REX,OSBC,MERC,HA,CEVA,BOC,HCKT,HLVX,HBT,WTI,DMRC,ASPN,CENX,LYEL,HOUS,CCO,ADMA,SP,BIGC,MDXG,NVRI,RBCAA,CANO,SPTN,APLD,KURA,HPP,RMR,ACRS,CGBD,CRON,WKME,ALLG,WEAV,CSWC,ASTL,CHUY,ETD,NRDS,AMAM,CLSK,COLL,STKL,ARDX,EDIT,OFIX,SHYF,GSL,KOP,REPX,SCSC,NRDY,ASLE,BALY,ZH,PGRU,VERA,RWT,KARO,DCOM,BLBD,CLFD,QCRH,HSTM,PDS,RAPT,PSFE,BKD,VMEO,BV,KE,EGBN,CRAI,BANC,MODV,DBI,BASE,BY,HCAT,SBOW,CHS,TITN,MAX,LVRO,AVXL,HHRS,VSEC,LASR,NMM,MESO,MRC,WRLD,CFFN,VRDN,SNPO,ALTI,SII,THRY,IMTX,PRM,UBA,VTOL,SBGI,PRDO,NNOX,HUYA,GTN,NGD,BXC,NPWR,ADTN,ALLO,PRA,EVA,BFC,BBDC,CDMO,RGNX,PIII,GNLX,FBMS,HY,SCHN,HZO,INVA,RSKD,FDMT,RSI,AVO,TELL,CDRE,TMP,PHAT,TGI,SSP,UTL,ME,BRKL,SBSI,HRT,CINT,INN,PRTC,BJRI,NVAX,WEST,PHAR,IIIV,GABC,GGR,WDH,SLRC,GDYN,RNA,AC,BDN,WLKP,ACMR,MVIS,NAT,PWP,SOUN,SMRT,ADV,BIOX,REVG,BLX,LXU,BLFS,PUBM,PNT,ICHR,AVTA,NKLA,BHLB,KNSA,CCRN,OCFC,PACW,EIG,HWKN,UUUU,RTL,NAMS,AMPS,INNV,SSU,BGS,ROVR,OM,PDM,DCGO,ACEL,SHEN,FCEL,BHE,CHCT,PL,SILV,IMXI,SKWD,SPH,VREX,CAL,RPT,RYTM,IMAX,PAR,PRLB,DRD,DIN,AMRX,NYMT,QTRX,GEO,SAVA,OBK,PEBO,BRSP,GIII,TTGT,EFC,BZH,AMRK,SLP,VTLE,NVRO,NGMS,LBAI,BCSF,SILK,EXAI,RDWR,VTEX,PKST,BSIG,PRAA,DRQ,DAWN,AOSL,CYRX,KREF,EVLV,PFBC,FUBO,TLRY,DSGR,BYND,INBX,AVPT,CLB,XMTR,CHGG,TDCX,GNL,NXGN,WABC,STBA,PLRX,AHH,MNKD,LNZA,CLNE,SPCE,ADPT,DCPH,WWW,CXW,PUMP,CRNX,MTTR,LC,CBAY,ATEN,KRO,NTST,APOG,BRCC,STEM,FWRG,GES,FVRR,HCSG,TUYA,SRCE,HOPE,LICY,SHCO,SIBN,TRUP,CIFR,APPS,AGRO,RXST,DNN,SLCA,SASR,LPG,OLO,NBR,VALN,MOR,AXL,ACCD,NVGS,ANIP,EB,ASTE,NIC,ASIX,ARLO,VBTX,CSR,WTTR,FRG,WT,KIDS,ARR,FSM,EQRX,XPOF,HCCI,AMSF,ALHC,MIRM,UMH,CDE,MED,GDOT,HTLF,LOB,KYMR,NXRT,MPLN,PLYA,MEI,VERV,YEXT,AAT,VECO,PAY,NSSC,KFRC,MLKN,AVID,HTLD,DCBO,HLX,OTLY,STEL,MRUS,EVBG,CMRE,AMWD,PMT,EAF,NBHC,KALU,KRP,ACHR,ADEA,UNFI,GEL,EWCZ,DOLE,SPHR,MAG,CMCO,DNOW,CBD,MBUU,UEC,ECPG,SANA,PGRE,LGND,KROS,MBIN,OSW,FBRT,USNA,GDEN,KIND,UNIT,AVNS,BUSE,OPAL,PTGX,FOR,REPL,HAIN,CRNC,MNTK,INFN,HMN,EMBC,STER,FLGT,TBLA,TVTX,SKIN,PGY,MD,TCBK,TRS,IBRX,MFA,KRUS,CIR,STC,PLL,WNC,CUBI,LTC,CGAU,MDRX,ADUS,GCMG,RPAY,AMPL,ALEX,MAXN,AFYA,SNDX,PTVE,OSTK,IAG,NWBI,VZIO,LADR,ATSG,FINV,UPWK,CHCO,IE,TARO,CMP,KC,TYGO,CTS,TNK,UFPT,WKC,MCRI,CPRX,LNN,BCRX,SGH,CASH,BBU,CLBT,ETNB,CLMT,FBK,TRMK,FCF,COCO,LMND,AZUL,EVRI,SFL,BLDP,ENFN,GBX,CIM,MODN,TWST,MEG,MMI,PX,TH,RVLV,COGT,FIGS,SNCY,HLF,INTR,IRBT,IDYA,HNI,HIMX,FBNC,OEC,CTKB,SSYS,ARVN,SBH,TWO,SABR,ESRT,LKFN,EVGO,PFS,LPRO,NMFC,ALKT,ACLX,IRWD,CMPR,RCKT,CNNE,PLAB,AROC,BANR,VLRS,LRN,DADA,AUPH,CODI,TTEC,DO,ANDE,GOGL,JBI,RLAY,ARHS,LOMA,RNST,AGIO,SEAT,HURN,WRBY,DK,TSLX,WSBC,VSCO,EFSC,AMLX,NWN,VRE,VKTX,ZIM,INDI,GSBD,IBTX,OCSL,PRG,MSC,USM,RYI,PRO,CAMT,MBC,FNA,TFIN,VVX,ZUO,SVC,ROAD,JELD,NUS,DEA,ELME,AKR,NG,CHEF,VRTS,TNC,NTB,DGII,TMCI,NAPA,SGHC,ATUS,KRNT,ECVT,DHT,PRME,LMAT,SPNS,TTMI,DFIN,CARS,MATW,SEMR,XNCR,MSEX,PLMR,XHR,NBTB,OMI,DDD,HBM,HIMS,VCEL,THRM,RDNT,SPWR,CRGY,KAR,GENI,STRL,AGYS,ETWO,SMTC,LILAK,LILA,PAYO,NVTS,TALO,ANGI,BKU,AESI,ANF,UPBD,MLNK,RES,DVAX,FORG,SWTX,NVEE,PEB,BKE,ESTA,BFH,AG,SG,USPH,HLIT,TOWN,FRME,PTLO,KTOS,DRH,RDFN,VRTV,ENVA,RCUS,CLDX,PDFS,PCT,PRCT,CTOS,AHCO,SWI,HEES,EAT,PERI,PCRX,MRTN,KN,VSTO,RLJ,UDMY,SAND,GTY,SUPN,OPK,VRNA,ATGE,OSCR,STRA,MCY,SXI,PGTI,EQX,RADI,CSGS,IVT,OXM,HBI,FLNG,PRIM,PARR,ARI,UCTT,ERII,GERN,CMTG,SIX,TRMD,MGNI,CWK,FFBC,SCL,HRMY,PPBI,MRCY,VTYX,HCC,COUR,VCYT,LUMN,GPRE,FULT,PRMW,UE,EGO,ERO,JBGS,BOWL,USAC,CENT,AIR,CVBF,CTRE,SBCF,ACDC,BORR,SSTK,STGW,JACK,EPC,GTX,PLYM,OSIS,CNK,RVNC,RC,GPOR,GETY,FUN,MOMO,QTWO,CRTO,PLAY,IOVA,ZNTL,GSAT,TBBK,LAUR,NS,SLVM,CLS,TNDM,CLBK,RAMP,MYGN,MIR,GOOS,ZIP,EYE,AMEH,COMP,BVN,CAKE,SAFE,HLMN,PJT,BRDG,SOVO,PHR,ECX,ODP,MOD,ZETA,BOH,PATK,INSW,COHU,CRSR,SBLK,SKYW,SAH,DH,GVA,CBU,KW,ARLP,BLMN,YY,GFF,MYRG,KMT,ALGT,XPEL,BRC,VRNT,GSHD,DFH,PI,EE,OLK,NHI,RXRX,ARCB,CORT,SFBS,GBDC,NXE,ALG,AMK,AMR,NUVA,RNW,EBC,DKL,FSR,VET,UTZ,SFNC,OII,CEIX,DOOR,VCTR,HTGC,EQC,CVAC,PAX,TROX,DICE,AMBP,JKS,PD,XPRO,ULCC,EVCM,NGVT,GOGO,ATEC,KTB,ARCO,SONO,CAAP,HLIO,NMIH,MRTX,FSLY,SJW,CPE,ABCL,NTCT,AGTI,ICFI,AVDX,NEO,ESTE,CPK,SLG,IIPR,CALM,GDS,CBRL,ENLT,SHO,SIMO,INDB,B,ARCH,SAVE,HTH,TRN,WGO,BOOT,TCBI,KFY,CWH,CARG,FORM,HIW,SYM,LBRT,MXL,CSTM,INTA,OUT,JXN,STNG,AMPH,DNUT,MORF,DAN,KDNY,AVAV,ASB,YELP,GDRX,TAC,DORM,NABL,PSEC,REZI,IDCC,ACIW,VIAV,RPD,MWA,IMVT,FIBK,SHOO,WOOF,CVCO,XRX,GLNG,TGLS,FTCH,PZZA,KAI,CRDO,AX,ABCB,MHO,MTRN,AKRO,TRIP,PRGS,CSIQ,JAMF,PIPR,SCPL,LZ,VIST,GRBK,CATY,CCS,XENE,ATRC,AXNX,BEAM,FHB,RXO,VICR,SKT,NOVA,FL,HASI,HEP,NEX,WSFS,TWKS,NAVI,AEO,NUVL,ENR,RLX,AYX,UMBF,VRRM,JJSF,ARRY,UCBI,SSRM,LXP,SPR,MEOH,BTE,WDFC,BNL,FHI,MCW,AIN,DQ,QFIN,KOS,NOMD,IAS,TDW,KD,PTCT,CNX,ARNC,IONQ,AMED,SITC,AVA,PK,SXT,CEQP,PBH,RKLB,HAYW,JBLU,TMDX,PTEN,THS,WD,VIRT,SBRA,SPT,GMS,NPO,TIGO,MARA,RVMD,FROG,ACVA,VERX,LIVN,AMRC,VRNS,SAGE,FWRD,CWT,IFS,PRVA,TV,MQ,CRCT,ABM,CRI,MATX,MGEE,BRP,UNF,WERN,CRS,ZLAB,FTDR,PLXS,SITM,DBRG,INSM,OLPX,DEI,KSS,CNO,ITGR,AY,OR,GLPG,ALRM,HUBG,STEP,ERJ,HMY,STAA,PACB,OI,DOC,NWE,UAA,BSM,RELY,FLYW,AWI,CYTK,OTTR,RUSHA,BL,SR,SHAK,CRC,AGO,AMBA,LOPE,RUM,ENV,WNS,TWNK,OMCL,SIG,ITRI,VSAT,DY,LAC,IHS,CALX,LFST,CRK,CVLT,ALE,APAM,URBN,PINC,TNL,ESMT,TPH,TGTX,MAIN,CXT,LCII,JWN,BHF,EVH,GO,FRPT,KRYS,ERF,AZTA,EURN,PAGS,NVMI,NARI,VIR,PDCO,CHPT,SPB,OPEN,DAVA,ENVX,FTAI,HELE,KLIC,LGIH,CVI,ROG,MRVI,CCOI,BCO,RARE,WB,BANF,IMCR,BHC,FG,RIOT,IRTC,MMYT,HGTY,KMPR,PRFT,CCU,LAZR,BTU,NOG,CD,CERT,BKH,INST,THG,CWAN,CPG,PNM,UBSI,SFM,CXM,SDGR,GTES,YOU,CBT,SKY,SEM,VNO,KRC,CADE,DISH,JBT,LAZ,FUL,ETRN,HP,ASGN,MODG,BMBL,GPI,BXMT,INMD,GOLF,BCC,ATHM,LITE,MANU,AVNT,WHD,SAM,ACA,AB,HI,APPN,RNG,STNE,SANM,TGNA,NCR,BE,EXPI,YETI,LU,CABO,PGNY,UPST,TFSL,SPXC,NNI,ARWR,SMPL,PFSI,EPRT,BPMC,CUZ,SYNA,ZGN,HWC,PRTA,ENOV,HL,KWR,WOR,APLE,NCNO,COOP,IART,SEAS,FOLD,FRO,GPS,GEF,EPR,ROIC,EXTR,MC,GBCI,GKOS,ZD,MDC,AXSM,WIX,HLNE,LNC,DRS,CNXC,BAK,DEN,MDU,M,SYNH,DNA,UGP,GH,SUM,KOF,HAE,FCFS,FNB,NSP,LYFT,ONB,ICUI,SRAD,SRCL,LTH,OGS,BOX,AMN,IPAR,WAL,EVO,SQSP,AEIS,ACT,PCH,OMAB,S,KBH,OLLI,NVCR,TEX,CPRI,TAL,BRZE,DOCN,CPA,BCPC,VNOM,BMI,PWSC,AAP,DIOD,GT,MAN,ESAB,VLY,SHLS,FFIN,BDC,IRT,HRI,IBP,RUN,AEL,PENN,FOCS,TSEM,CNMD,RETA,VSH,HHC,NWL,AUR,NTLA,SLM,DNLI,MDGL,SM,TDOC,RDN,SMG,LEG,BLKB,ADNT,DLO,R,ESNT,PBF,FRSH,DTM,RRR,CWST,FLS,KRG,AGI,ENSG,PSN,ORA,EVR,ALKS,TRNO,NSIT,TENB,ASAN,BROS,NEWR,BTG,HALO,COLM,ASND,HRB,FELE,SBSW,AFRM,MMSI,NEOG,VAC,AL,OZK,FN,IMGN,FLNC,EXPO,CERE,HOMB,NFG,MTSI,QLYS,SNV,BRBR,JHG,NSA,RYN,ESI,WTFC,ASH,FOXF,AI,PLTK,TRTN,SWX,AZEK,ZION,MSGS,PNFP,MTG,CIGI,DRVN,POR,PEGA,BPOP,AVT,MGY,GATX,KEX,RITM,CRSP,WEN,MP,CRUS,ENS,NJR,AXS,QS,COLB,PCVX,ASO,NVEI,SUN,VC,WU,PYCR,FLR,ATKR,EEFT,REYN,NTRA,MLCO,IAC,QDEL,BOKF,CIVI,PAAS,GIL,ACLS,LNTH,OFC,CC,PVH,FOUR,AM,NFE,RHP,AMG,SIGI,THO,SRC,X,UGI,AIT,LPX,SON,LEVI,BFAM,TDC,NVST,CWEN,POWI,SGRY,HQY,MSM,HCP,OMF,OPCH,FSK,POST,NXT,OBDC,ABCM,AQN,PPC,TNET,SMAR,PB,TMHC,ALIT,ABG,IQ,SSB,BECN,MSTR,WFRD,DDS,ONTO,WK,VAL,HGV,SLGN,ALSN,IDA,MTH,CR,SHC,KNTK,DNB,AYI,HUN,LANC,FLO,SLAB,OGN,HOG,ENLC,SNDR,LTHM,VNT,TXG,CACC,PLUG,ACHC,DOCS,OLED,ESTC,NYT,DV,STAG,SPSC,XPO,HLI,TKR,CCCS,GTLS,BRX,AIZ,CHX,EHC,SWN,FHN,NE,APG,RMBS,DSGX,CLVT,AMC,MUSA,FUTU,MSA,FCN,IPGP,JOBY,WF,HXL,NTNX,SF,DOOO,AA,CHRD,CIEN,EXP,CMC,IGT,NOVT,DUOL,RBC,BILI,PDCE,CYBR,MTDR,PR,GWRE,MUR,NXST,BZ,EXEL,SEE,WH,STWD,BC,CMA,KGC,VVV,RLI,GMED,PLNT,CBSH,ELF,RIG,SAIC,LNW,FIVN,ADC,VMI,IONS,CHH,WTS,GBTG,ALTR,INFA,AGNC,ITCI,UFPI,SSD,FAF,FIX,HTZ,KT,ADT,ATI,MPW,DXC,OSK,TX,LBTYK,LBTYA,ARW,FRT,RH,WWE,SEIC,WOLF,AN,EGP,GTLB,EWBC,SKX,JAZZ,RGLD,ITT,CHE,ALV,JLL,CACI,BERY,MIDD,PSO,FTI,GLOB,SITE,CROX,NNN,EDU,KRTX,JEF,W,MAT,MASI,TXRH,TREX,ATR,GXO,TPX,WRK,DCI,VFC,IRDM,ICL,NATI,COHR,OHI,RCM,ORI,STN,WFG,YMM,AXTA,FR,LFUS,CSAN,PII,MEDP,GPK,CVNA,CNM,PRI,CW,GLBE,OGE,MHK,HR,NOV,INGR,WWD,HESM,VOYA,GNTX,OLN,ALK,AR,CFR,GME,RRC,BLCO,WBS,FSV,AGL,LSTR,MKSI,BYD,AMKR,TIMB,CAE,G,APPF,ST,PAA,TPR,PCOR,FNF,SCI,PSNY,SRPT,AFG,VST,JNPR,RRX,CHDN,EQH,PATH,WSC,NLY,VRT,RNR,UHS,DBX,PFGC,KEY,UWMC,WMS,PAC,NBIX,SAIA,TFII,DVA,MKTX,PNW,VIPS,MTN,CAR,UNM,RGA,INSP,GNRC,NCLH,FBIN,TEVA,TPG,HII,SNX,KNX,WCC,AU,CASY,ALGM,MTZ,LEA,HAS,CLH,TOL,FFIV,DINO,EME,LAD,TTEK,CLF,BJ,KBR,BLD,ROIV,RHI,NRG,COLD,XRAY,SOFI,NVT,DLB,ASR,THC,STVN,NYCB,RL,ALLY,KNSL,IVZ,BBWI,MNDY,WSM,RGEN,CTLT,GRFS,ACM,GEN,JKHY,FND,CRBG,TWLO,OC,DKS,PKG,CG,GDDY,FMC,IHG,MOS,CPT,LII,RPM,PAGP,BEPC,BIO,AZPN,WPP,DOX,RYAN,NI,NWSA,TFX,APA,PEAK,PSTG,OKTA,CELH,LEGN,LECO,CZR,YPF,PCTY,CHRW,NEP,ETSY,CHK,FIVE,ZI,OTEX,UI,AOS,IP,ARMK,REXR,BRKR,PNR,TPL,RBA,UHAL,TTC,BWA,PARA,REG,OVV,CRL,HOOD,UTHR,ALLE,AEG,ROKU,WTRG,COTY,CCK,HSIC,GL,BURL,CX,CFLT,BXP,CDAY,RDY,EMN,ARCC,DOCU,QGEN,WES,QRVO,CNA,LOGI,CUBE,LAMR,USFD,APP,ONON,SWAV,DAR,CINF,BSY,NTRS,WRB,CHKP,MRO,SEDG,FDS,ASX,POOL,RVTY,FMS,SJM,SSNC,SYF,IPG,WPC,AGR,SWK,BAH,IOT,WMG,AMCR,WSO,SMCI,JBL,DECK,GGG,AXON,AES,CBOE,EQT,AVY,TAP,BEN,UDR,VIV,GRAB,NDSN,CF,AVTR,INCY,AKAM,EG,TXT,DPZ,GFL,CPB,CCJ,CFG,LNT,EPAM,CSL,SNN,TRMB,KMX,TECH,HTHT,MAS,CE,GFI,LSCC,TOST,LCID,ELS,XP,AMH,XPEV,MTCH,NICE,MMP,BILL,ACI,STX,GLPI,KIM,H,HST,TME,FLEX,WYNN,ZG,Z,PAG,MANH,WDC,VTRS,LDOS,PEN,LBRDK,LBRDA,AAL,ZM,FTS,NVR,PAYC,HWM,GRMN,ARE,RKT,FICO,WAB,DRI,COIN,ZS,CTRA,ICLR,PODD,CNHI,VTR,TDY,PPL,PINS,RTO,BR,BRO,HOLX,CLX,UMC,COO,CNP,JBHT,BEP,PFG,FLT,OMC,LH,MAA,EXPD,TS,FCNCA,SIRI,FITB,MKL,BEKE,TSN,UAL,STLD,SWKS,PHM,TRGP,BLDR,BALL,HUBB,CMS,RF,BBY,TYL,EXAS,ATO,IRM,TER,PTC,EXPE,SPLK,MGM,PBA,LPLA,MOH,SUI,RS,U,FOXA,WLK,NTAP,LW,IEX,ZBRA,AER,HBAN,ENTG,BMRN,ESS,CHWY,WAT,EDR,CAG,DGX,J,LKQ,TW,DT,EFX,IT,AWK,ALL,NWG,FNV,TU,MDB,AVB,MLM,ALGN,EIX,HUBS,CBRE,IR,XYL,MPWR,RBLX,FTV,BNTX,EQR,SBAC,TROW,DKNG,AEM,RCL,TTWO,GMAB,FANG,ES,CDW,ALNY,ENPH,WY,WIT,EBAY,YUMC,WTW,NDAQ,GIB,RIVN,TSCO,ULTA,CHD,GPC,CAH,HZNP,FMX,TEF,BAX,BIP,CQP,K,DTE,LUV,MT,MKC,BSBR,RCI,FE,HIG,TCOM,VRSN,STE,RJF,EC,AEE,CCL,HPE,MTB,SQM,ROL,TECK,EXR,INVH,SNAP,HRL,NET,LYV,DOV,RYAAY,HEI,ZTO,PHG,BGNE,FSLR,IFF,ETR,CM,ABC,CTVA,DOW,LNG,ROST,YUM,PUK,GEHC,SYY,LHX,LYG,NU,LEN,DG,EA,SGEN,AME,PCG,MBLY,LI,CSGP,NEM,GFS,WCN,IBKR,PPG,BK,A,AMP,PLTR,XEL,FIS,CNC,BKR,MPLX,CRWD,SE,MFC,QSR,DLR,HAL,KR,DDOG,PRU,BBD,DD,CVE,VEEV,VRSK,DVN,SPOT,DLTR,HPQ,FAST,ED,URI,WBD,VICI,RMD,APTV,PEG,DASH,BCS,CPNG,CEG,ORAN,GOLD,DAL,FWONK,FWONA,LYB,DFS,GLW,ANSS,KEYS,ILMN,SLF,ZBH,CCEP,NTR,VMC,ARES,MTD,PWR,OKE,IMO,WEC,ALB,GPN,WST,ACGL,MCK,NXPI,OXY,CHTR,BN,MRVL,USB,ITUB,ECL,HUM,EMR,NSC,PSA,DXCM,ING,BIDU,PH,APH,MPC,ROP,PNC,LULU,ANET,KKR,CCI,HMC,PXD,E,CTAS,MSI,MCHP,TAK,TDG,KVUE,NGG,MRNA,ABEV,JCI,RSG,STM,SRE,PSX,AZO,AJG,ADSK,STZ,SPG,KMB,LVS,TEAM,PCAR,MET,AEP,TT,CARR,APO,D,TFC,KDP,KHC,GIS,IDXX,CPRT,HES,SQ,AIG,COF,ADM,PAYX,NUE,ON,AFL,DHI,ALC,EXC,VLO,WMB,TTD,ODFL,CRH,IQV,BCE,O,ET,BIIB,MSCI,WELL,TRV,DELL,KMI,TRP,ROK,GWW,SU,T,SCHW,BP,BKNG,PDD,ADI,ELV,TJX,MDLZ,DEO,GILD,ADP,MMC,C,AMT,CVS,UBER,VRTX,ABNB,PBR,SHOP,LRCX,MO,HCA,SLB,ETN,RACE,CI,ZTS,CB,REGN,PYPL,FI,SO,CNI,BSX,ITW,BDX,ENB,EQIX,CP,EOG,DUK,PANW,ATVI,MU,AMX,NOC,WM,AON,EL,CSX,INFY,PGR,SNPS,VMW,UBS,FDX,APD,CME,BMO,ICE,KLAC,CNQ,CDNS,NTES,CL,FTNT,TGT,F,SMFG,VALE,GD,TRI,ORLY,MNST,BNS,STLA,FCX,EPD,MAR,SCCO,MELI,WDAY,CMG,EW,GM,SNOW,JD,AAPL,MSFT,GOOGL,GOOG,AMZN,NVDA,TSLA,META,V,TSM,JPM,XOM,UNH,LLY,WMT,JNJ,MA,AVGO,PG,NVO,HD,ORCL,ASML,MRK,KO,PEP,BABA,COST,ABBV,BAC,ADBE,CRM,TM,MCD,ACN,CSCO,AZN,PFE,TMO,NFLX,NVS,ABT,AMD,LIN,CMCSA,DHR,TMUS,NKE,TXN,DIS,SAP,WFC,UPS,HSBC,PM,BHP,NEE,VZ,MS,TTE,INTC,HON,LOW,INTU,RY,COP,QCOM,SNY,BMY,BA,SPGI,AXP,UNP,ISRG,GE,IBM,AMGN,DE,PLD,BX,LMT,AMAT,MDT,SBUX,NOW,BUD,TD,SYK,RIO,SONY,BLK,GS'.split(',')

import qlib
from qlib.contrib.data.handler import Alpha158

data_handler_config = {
    "start_time": "2022-07-21",
    "end_time": "2023-08-21",
    "fit_start_time": "2022-07-21",
    "fit_end_time": "2023-07-17",
    "instruments": tickers,
    "freq": 'day',
}

qlib.init(provider_uri={'day': '~/.qlib/qlib_data/my_data/' })
h = Alpha158(**data_handler_config)

alpha158_df = h.fetch(col_set="feature")

import json
import pandas as pd
import numpy as np
import pandas_ta as ta

keys = ['ticker', 'changeAmount', 'changePercent', 'lastClose', 'high52Weeks', 'low52Weeks', 'peRatio', 'price', 'totalValue', 'volume']

research_keys = ['oneMonthGain', 'peRatio', 'price', 'sixMonthsGain', 'threeMonthsGain', 'yearlyGain']

old_stocks = json.load(open('../data/stocks.json', 'r'))
stocks = []

yf_str_keys = ['industry', 'country', 'exchange', 'sector']
yf_keys = ['auditRisk', 'boardRisk', 'compensationRisk', 'shareHolderRightsRisk', 'targetHighPrice', 'targetLowPrice', 'overallRisk', 'governanceEpochDate', 'compensationAsOfEpochDate', 'priceHint', 'dividendRate', 'dividendYield', 'payoutRatio', 'fiveYearAvgDividendYield', 'beta', 'trailingPE', 'forwardPE', 'volume', 'marketCap', 'priceToSalesTrailing12Months', 'fiftyDayAverage', 'twoHundredDayAverage', 'trailingAnnualDividendRate', 'trailingAnnualDividendYield', 'profitMargins', 'floatShares', 'sharesOutstanding', 'sharesShort', 'sharesShortPriorMonth', 'sharesShortPreviousMonthDate', 'sharesPercentSharesOut', 'heldPercentInsiders', 'heldPercentInstitutions', 'shortRatio', 'shortPercentOfFloat', 'impliedSharesOutstanding', 'bookValue', 'priceToBook', 'earningsQuarterlyGrowth', 'netIncomeToCommon', 'trailingEps', 'forwardEps', 'pegRatio', 'lastSplitDate', 'enterpriseToRevenue', 'enterpriseToEbitda', '52WeekChange', 'lastDividendValue', 'lastDividendDate', 'targetMeanPrice', 'numberOfAnalystOpinions', 'totalCash', 'totalCashPerShare', 'ebitda', 'totalDebt', 'quickRatio', 'currentRatio', 'totalRevenue', 'debtToEquity', 'revenuePerShare', 'returnOnAssets', 'returnOnEquity', 'grossProfits', 'freeCashflow', 'operatingCashflow', 'earningsGrowth', 'revenueGrowth', 'grossMargins', 'ebitdaMargins', 'operatingMargins', 'trailingPegRatio']

problematic_stocks = []
start_date = pd.to_datetime('2023-07-16', utc=True)
#end_date = pd.to_datetime('2023-07-31', utc=True)
#end_date = pd.to_datetime('2023-08-16', utc=True)
end_date = pd.to_datetime('2023-07-23', utc=True)

alpha158_data = {}
for k in alpha158_df.columns:
    alpha158_data[k] = alpha158_df[k]['2023-07-17'].to_dict()
print('alpha158', alpha158_df.columns)

for i, stock in enumerate(old_stocks):
    item = {}

    if stock['bestAnalystConsensus']['consensus'] == None:
        item['analystConsensus'] = stock['analystConsensus']['consensus']
    else:
        item['analystConsensus'] = stock['bestAnalystConsensus']['consensus']
    if item['analystConsensus'] == None:
        continue

    for k in keys:
        item[k] = stock[k]

    for k in stock['technicalIndicators']:
        item[k] = stock['technicalIndicators'][k]

    for k in research_keys:
        item[k] = stock['research'][k]

    flag = False
    for k in item:
        if item[k] == None:
            # print(item)
            flag = True
            break

    #emA21d,emA50d,movingAvg21d,movingAvg50d,movingAvg200d

    ticker = item["ticker"]
    raw_info = open(f'../data/stocks/{ticker}.json', 'r').read()
    info = json.loads(raw_info)
    try:
        df = pd.read_csv(f'../data/history/{ticker}.json', parse_dates=['Date'])
        start = df[df['Date'] >= start_date].iloc[0].to_dict()
        end = df[df['Date'] >= end_date].iloc[0].to_dict()
        if start['Open'] > item['price'] * 1.1 or start['Open'] < item['price'] * 0.9:
            continue
    except:
        continue

    for k in yf_keys:
        item[k] = info.get(k, None)
        if item[k] == 'Infinity' or item[k] != None and item[k] > 1e10:
            item[k] = 1e10
    for k in yf_str_keys:
        item[k] = info.get(k, None)

    cnt = 0
    for k in item:
        if type(item[k]) != str and item[k] != None and np.isnan(item[k]):
            item[k] = None
        if item[k] == 0 or item[k] == None:
            cnt += 1
    if cnt > 30:
        problematic_stocks.append(ticker)
        continue
    
    try:
        for k in alpha158_data:
            item[k] = alpha158_data[k][ticker]
    except:
        continue
    
    item['price'] = start['Open']
    item['rating'] = end['Close'] / start['Open']
    
    item['Price-to-21emA'] = item['price'] / item['emA21d']
    item['Price-to-50emA'] = item['price'] / item['emA50d']
    item['Price-to-200dmA'] = item['price'] / item['movingAvg200d']
    item['21dmA>50dmA>200dmA'] = item['movingAvg21d'] > item['movingAvg50d'] and item['movingAvg50d'] > item['movingAvg200d']
    item['high52Weeks-low52Weeks'] = item['high52Weeks'] - item['low52Weeks']
    item['volume-volumeAvg10d'] = item['volume'] - item['volumeAvg10d']
    item['volume-volumeAvg30d'] = item['volume'] - item['volumeAvg30d']
    item['volume-volumeAvg90d'] = item['volume'] - item['volumeAvg90d']
    item['volumeAvg10d-volumeAvg90d'] = item['volumeAvg10d'] - item['volumeAvg90d']
    #if item['rating'] > 25:
    #    continue

    del item['movingAvg21d']
    del item['movingAvg50d']
    del item['emA21d']
    del item['emA50d']
    del item['twoHundredDayAverage']
    del item['sharesShortPreviousMonthDate']
    del item['lastClose']
    del item['fiftyDayAverage']
    del item['movingAvg200d']
    del item['high52Weeks']
    del item['low52Weeks']
    stocks.append(item)

df = pd.DataFrame(stocks)

df.insert(0, 'previousConsensus', df['analystConsensus'].values.copy())
df['rating'] /= df['rating'].mean()
df['analystConsensus'] = 'hold'
df['analystConsensus'][df['rating'] < 0.95] = 'sell'
df['analystConsensus'][df['rating'] > 1.05] = 'buy'

for k in df.columns:
    if k in alpha158_data or k == 'rating':
        continue
    if df[k].dtype == float or df[k].dtype == int:
        x = df[k].values
        x = x[~np.isnan(x)]
        q_hi  = np.quantile(x, 0.995)
        q_lo  = np.quantile(x, 0.005)
        #print(k, q_hi, q_lo)

        df.loc[df[k] > q_hi, k] = q_hi
        df.loc[df[k] < q_lo, k] = q_lo

for k in df.columns:
    if df[k].isna().sum() > 2000:
        df = df.drop(k, axis = 1)

df.to_csv('stock.csv', index=False)
new_df = df.drop('rating', axis=1)
new_df = new_df.drop('ticker', axis=1)

print(new_df['analystConsensus'].value_counts())

import pandas as pd
from sklearn.ensemble import RandomForestClassifier
from sklearn.neural_network import MLPClassifier
from lightgbm import LGBMClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score

X = new_df.drop('analystConsensus', axis=1)
y = new_df['analystConsensus']
        
for category in yf_str_keys:
    category_counts = X[category].value_counts()
    low_count_categories = category_counts[category_counts < 50].index
    X.loc[X[category].isin(low_count_categories), category] = 'Others'

X_encoded = pd.get_dummies(X, columns = yf_str_keys + ['previousConsensus'])
X_train, X_test, y_train, y_test = train_test_split(X_encoded, y, test_size=0.2, random_state=42)

from sklearn.metrics import confusion_matrix

model = LGBMClassifier(**{
'n_estimators': 150, 'learning_rate': 0.05933959908326045, 'max_depth': 3, 'lambda_l1': 8.239690865892566, 'lambda_l2': 5.099588170103722, 'num_leaves': 180, 'feature_fraction': 0.2368029257738345, 'bagging_fraction': 0.8723237313172197, 'bagging_freq': 9, 'min_child_samples': 95},
                       class_weight = 'balanced',
                       random_state=42,
                       verbose = -1)

current_features = X_train.columns
drop_features = []
model.fit(X_train.values, y_train)

y_pred = model.predict(X_test.values)
test_accuracy = accuracy_score(y_test, y_pred)
conf_mat = confusion_matrix(y_test, y_pred)
print(conf_mat)

y_pred = model.predict(X_train.values)
train_accuracy = accuracy_score(y_train, y_pred)
print("Accuracy(test / train): ", test_accuracy, train_accuracy)

sorted_features = [(model.feature_name_[i], model.feature_importances_[i]) for i in range(len(model.feature_importances_))]
sorted_features = sorted(sorted_features, key = lambda x: -x[1])
for k in sorted_features[:20]:
    # pass
    print(k)

from sklearn.metrics import roc_auc_score, roc_curve, auc
from sklearn.preprocessing import label_binarize

classes = model.classes_
num_classes = len(classes)
y_pred = model.predict_proba(X_test.values)
y_test_bin = label_binarize(y_test, classes=classes)

accuracys = []
for i in range(num_classes):
    accuracy = conf_mat[i, i] / conf_mat[i].sum()
    accuracys.append(accuracy)
    print(f'Accuracy on {classes[i]}: {accuracy}')
print('Average accuracy: ', np.mean(accuracys))

auc_list = []

'''
for i in range(num_classes):
    fpr, tpr, _ = roc_curve(y_test_bin[:, i], y_pred[:, i])
    roc_auc = auc(fpr, tpr)
    auc_list.append(roc_auc)
'''

for i in range(num_classes):
    for j in range(i+1, num_classes):
        y_i = y_pred[:, i]
        y_j = y_pred[:, j]
        true_i = y_test_bin[:, i]
        true_j = y_test_bin[:, j]
        
        y_ij = np.column_stack((y_i, y_j))
        true_ij = np.column_stack((true_i, true_j))
        
        # 计算AUC并添加到列表中
        auc = roc_auc_score(true_ij, y_ij)
        print(f'AUC between {classes[i]} and {classes[j]}: ', auc)
        auc_list.append(auc)
# 计算平均AUC

mean_auc = np.mean(auc_list)
print("Average AUC:", mean_auc)

from tabnanny import verbose
import optuna  # pip install optuna
from sklearn.metrics import log_loss, precision_score, f1_score, accuracy_score
from sklearn.model_selection import KFold
from optuna.integration import LightGBMPruningCallback
from lightgbm import LGBMClassifier
random_state = 10

def objective(trial, X_train, y_train, X_test, y_test):
    # 后面填充
    param_grid = {
        "n_estimators": trial.suggest_int("n_estimators", 50, 300, step=20),
        "learning_rate": trial.suggest_float("learning_rate", 0.001, 0.05),
        "max_depth": trial.suggest_int("max_depth", 3, 7),
        "lambda_l1": trial.suggest_float("lambda_l1", 1e-8, 10.0),
        "lambda_l2": trial.suggest_float("lambda_l2", 1e-8, 10.0),
        #"num_leaves": trial.suggest_int("num_leaves", 2, 256),
        "feature_fraction": trial.suggest_float("feature_fraction", 0.1, 1.0),
        "bagging_fraction": trial.suggest_float("bagging_fraction", 0.1, 1.0),
        "bagging_freq": trial.suggest_int("bagging_freq", 1, 9),
        "min_child_samples": trial.suggest_int("min_child_samples", 30, 100),
    }

    model = LGBMClassifier(**param_grid, verbose=-1, class_weight = 'balanced', random_state=42)
    model.fit(X_train.values, y_train)

    y_pred = model.predict(X_test.values)
    test_accuracy = accuracy_score(y_test, y_pred)
    conf_mat = confusion_matrix(y_test, y_pred)
    classes = model.classes_
    num_classes = len(classes)

    y_pred = model.predict_proba(X_test.values)

    accuracys = []
    for i in range(num_classes):
        accuracy = conf_mat[i, i] / conf_mat[i].sum()
        accuracys.append(accuracy)

    mean_accuracy = (accuracys[0] + accuracys[2] + accuracys[1] * 2) / 4
    return mean_accuracy

study = optuna.create_study(direction="maximize", study_name="LGBM Classifier")
func = lambda trial: objective(trial, X_train, y_train, X_test, y_test)
study.optimize(func, n_trials=5000)

print(study.best_params)


model = LGBMClassifier(**study.best_params, verbose=-1, class_weight = 'balanced', random_state=42)
model.fit(X_train.values, y_train)

y_pred = model.predict(X_test.values)
test_accuracy = accuracy_score(y_test, y_pred)
conf_mat = confusion_matrix(y_test, y_pred)
print(conf_mat)
print("Accuracy(test / train): ", test_accuracy, train_accuracy)

accuracys = []
for i in range(num_classes):
    accuracy = conf_mat[i, i] / conf_mat[i].sum()
    accuracys.append(accuracy)

print(accuracys)